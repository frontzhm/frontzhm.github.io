<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="frontzhm, zhm, huahua, hua_hua" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="hello world">
<meta property="og:type" content="website">
<meta property="og:title" content="花花的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="花花的博客">
<meta property="og:description" content="hello world">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="花花的博客">
<meta name="twitter:description" content="hello world">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> 花花的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?60f2cb5747a596a24f2a053f1650c30b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">花花的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/29/observer-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/29/observer-code/" itemprop="url">
                  观察者模式简单版
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-29T14:56:01+08:00">
                2019-03-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/29/observer-code/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/03/29/observer-code/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h1><p>两个角色：观察者 被观察者。</p>
<p>代码实现的逻辑：</p>
<ul>
<li>被观察者 需要放在 观察者 中。</li>
<li>被观察者 要提供一个更新也就是update的方法。</li>
<li>当 被观察者 的数据发送变化时，需要执行 观察者 的 update 方法。</li>
</ul>
<p>观察者模式 是有关系的。基于发布订阅。</p>
<p>被观察者提供两个方法，一个是添加观察者，一个自己状态改变<br>观察者提供 update的方法，供被观察者状态改变的时候，调用。</p>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p>父母观察小宝宝。 小宝宝就是被观察者。 父母就是观察者。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// observer 被观察者</span></span><br><span class="line"><span class="comment">// subject 观察者</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.state = <span class="string">'不开心'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Subject</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Subject.prototype.update = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o = <span class="keyword">new</span> Observer()</span><br><span class="line"><span class="keyword">let</span> s1 = <span class="keyword">new</span> Subject(<span class="string">'我'</span>,o)</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="keyword">new</span> Subject(<span class="string">'媳妇'</span>,o)</span><br></pre></td></tr></table></figure>
<p>再来完整版</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// observer 被观察者</span></span><br><span class="line"><span class="comment">// subject 观察者</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.state = <span class="string">"不开心"</span>;</span><br><span class="line">  <span class="keyword">this</span>.arr = [];</span><br><span class="line">&#125;</span><br><span class="line">Observer.prototype.attach = <span class="function"><span class="keyword">function</span>(<span class="params">s</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// subkect</span></span><br><span class="line">  <span class="keyword">this</span>.arr.push(s);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 状态改变</span></span><br><span class="line">Observer.prototype.setState = <span class="function"><span class="keyword">function</span>(<span class="params">newState</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.state = newState;</span><br><span class="line">  <span class="comment">// 让观察者都知道 s指的就是观察者</span></span><br><span class="line">  <span class="keyword">this</span>.arr.forEach(<span class="function"><span class="params">s</span> =&gt;</span> s.update(<span class="keyword">this</span>.state));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Subject</span>(<span class="params">name, observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.observer = observer;</span><br><span class="line">&#125;</span><br><span class="line">Subject.prototype.update = <span class="function"><span class="keyword">function</span>(<span class="params">newState</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name+<span class="string">'监测到了宝宝的'</span>+newState+<span class="string">'变化'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> o = <span class="keyword">new</span> Observer();</span><br><span class="line"><span class="keyword">let</span> s1 = <span class="keyword">new</span> Subject(<span class="string">"我"</span>, o);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="keyword">new</span> Subject(<span class="string">"媳妇"</span>, o);</span><br><span class="line">o.attach(s1);</span><br><span class="line">o.attach(s2);</span><br><span class="line">o.setState(<span class="string">'开心了'</span>)</span><br><span class="line">o.setState(<span class="string">'又不开心了'</span>)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/29/fetch_express/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/29/fetch_express/" itemprop="url">
                  fetch在post请求的时候必须加Content-Type
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-29T09:42:29+08:00">
                2019-03-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/29/fetch_express/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/03/29/fetch_express/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>fetch 默认的 Content-Type 是<code>text/plain</code>，在 post 请求的时候必须加<code>Content-Type:application/json</code>或者<code>Content-Type:application/x-www-form-urlencoded</code>。axios 和 jquery 的 ajax 默认是<code>application/x-www-form-urlencoded</code>。</p>
<h2 id="显示源码"><a href="#显示源码" class="headerlink" title="显示源码"></a>显示源码</h2><h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h3><p>fetch 的 get 请求只能在 url 后面写参数，不能再 body 里。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get请求后面拼参数</span></span><br><span class="line">fetch(<span class="string">"/api/login?e=9&amp;h=4"</span>).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  data.json();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器 req.query拿到对象&#123;e:9.h:4&#125;</span></span><br><span class="line">app.get(<span class="string">"/api/login"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.query);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch" target="_blank" rel="noopener">fetch</a>的 post 请求，可以像 get 那样传参数，但是多数放到 body 里。<br>body 的类型不能是对象，可以是<code>ArrayBuffer ArrayBufferView (Uint8Array等) Blob/File string URLSearchParams FormData</code>。</p>
<p>urlencoded字符串的时候，也就是<code>d=9&amp;h=9</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">"/api/login"</span>, &#123;</span><br><span class="line"><span class="comment">//   headers: new Headers(&#123; "Content-Type": "application/json" &#125;),</span></span><br><span class="line">  headers: <span class="keyword">new</span> Headers(&#123; <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span> &#125;),</span><br><span class="line">  body: <span class="string">`e=9&amp;h=4`</span>,</span><br><span class="line">  method: <span class="string">"POST"</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  data.json();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器 req.body拿到对象&#123;e:9.h:4&#125;</span></span><br><span class="line">app.use(express.urlencoded())</span><br><span class="line">app.post(<span class="string">"/api/login"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>json字符串的时候，也就是<code>{e:9,h:4}</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">"/api/login"</span>, &#123;</span><br><span class="line">  headers: <span class="keyword">new</span> Headers(&#123; <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span> &#125;),</span><br><span class="line">  body: <span class="built_in">JSON</span>.stringfy(&#123;<span class="attr">e</span>:<span class="number">9</span>,<span class="attr">h</span>:<span class="number">4</span>&#125;),</span><br><span class="line">  method: <span class="string">"POST"</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  data.json();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器 req.body拿到对象&#123;e:9.h:4&#125;</span></span><br><span class="line">app.use(express.json())</span><br><span class="line">app.post(<span class="string">"/api/login"</span>, (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考 <a href="http://qingbob.com/problems-caused-by-fetch-post/" target="_blank" rel="noopener">使用 fetch 接口的时候，记得指定 Content-Type</a><br>参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch" target="_blank" rel="noopener">mdn的 fetch </a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/28/usr-of-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/28/usr-of-linux/" itemprop="url">
                  linux的目录结构
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-28T14:54:13+08:00">
                2019-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统/" itemprop="url" rel="index">
                    <span itemprop="name">系统</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/28/usr-of-linux/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/03/28/usr-of-linux/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul>
<li>/usr 只专门存放各种程序和数据</li>
<li>/var中包括了一些数据文件，如系统日志等。/var的存放使得/usr被只读挂载成为可能。</li>
<li>/usr/local<br>新装的系统中这个文件夹是空的，可以用于存放个人安装的软件。安装了本地软件的/usr/local里的目录结构与/usr相似</li>
</ul>
<h2 id="误会"><a href="#误会" class="headerlink" title="误会"></a>误会</h2><p>说起来，我也以为<code>/usr</code>就是<code>user</code>的意思，然后就觉得<code>/home/xx</code>好奇怪。<br>好奇心的谷歌了下。<code>usr</code>是<code>unix system resources</code>。<br>所以，用处不是某个用户。<br>现代的 /usr 只专门存放各种程序和数据。<code>/usr</code> 是系统核心所在，包含了所有的共享文件。它是 unix 系统中最重要的目录之一，涵盖了二进制文件，各种文档，各种头文件，还有各种库文件；还有诸多程序，例如 <code>ftp，telnet</code> 等等。</p>
<h2 id="根文件系统"><a href="#根文件系统" class="headerlink" title="根文件系统"></a>根文件系统</h2><p>/bin<br>其中bin是binary的缩写，表示二进制文件，通常为可执行文件。一些常用的系统命令，如cp、ls等保存在该目录中。这一目录中存放了供所有用户使用的完成基本维护任务的命令。<br>/boot<br>这里存放的是启动Linux时使用的一些核心文件。如操作系统内核、引导程序Grub等。<br>/dev<br>在此目录中包含所有的系统设备文件。从此目录可以访问各种系统设备。如CD-ROM，磁盘驱动器，调制解调器和内存等。在该目录中还包含有各种实用功能，如用于创建设备文件的MAKEDEV。<br>/etc<br>该目录中包含系统和应用软件的配置文件。<br>/etc/passwd<br>该目录中包含了系统中的用户描述信息，每行记录一个用户的信息。<br>/home<br>存储普通用户的个人文件。每个用户的主目录均在/home下以自己的用户名命名。<br>/lib<br>这个目录里存放着系统最基本的共享链接库和内核模块。共享链接库在功能上类似于Windows里的.dll文件。<br>/lib64<br>64位系统有这个文件夹，64位程序的库。<br>/lost+found<br>这并不是Linux目录结构的组成部分，而是ext3文件系统用于保存丢失文件的地方。不恰当的关机操作和磁盘错误均会导致文件丢失，这意味着这些被标注为“在使用”，但却并未列于磁盘上的数据结构上。正常情况下，引导进程会运行fsck程序，该程序能发现这些文件。除了“/”分区上的这个目录外，在每个分区上均有一个lost+found目录。<br>/media<br>可移动设备的挂载点，当前的操作系统通常会把U盘等设备自动挂载到该文件夹下。<br>/mnt<br>临时用于挂载文件系统的地方。一般情况下这个目录是空的，而在我们将要挂载分区时在这个目录下建立目录，再将我们将要访问的设备挂载在这个目录上，这样我们就可访问文件了。（注意在GNOME中，只有挂载到/media的文件夹才会显示在“计算机”中，挂载到/mnt不会做为特殊设备显示，详见自动挂载分区）<br>/opt<br>多数第三方软件默认安装到此位置，如Adobe Reader、google-earth等。并不是每个系统都会创建这个目录。<br>/proc<br>它是存在于内存中的虚拟文件系统。里面保存了内核和进程的状态信息。多为文本文件，可以直接查看。如/proc/cpuinfo保存了有关CPU的信息。<br>/root<br>这是根用户的主目录。与保留给个人用户的/home下的目录很相似，该目录中还包含仅与根用户有关的条目。<br>/sbin<br>供超级用户使用的可执行文件，里面多是系统管理命令，如fsck, reboot, shutdown, ifconfig等。<br>/tmp<br>该目录用以保存临时文件。该目录具有Sticky特殊权限，所有用户都可以在这个目录中创建、编辑文件。但只有文件拥有者才能删除文件。为了加快临时文件的访问速度，有的实现把/tmp放在内存中。<br>/usr<br>静态的用户级应用程序等，见下。<br>/var<br>动态的程序数据等，见下文。<br>/usr目录结构<br>/usr通常是一个庞大的文件夹，其下的目录结构与根目录相似，但根目录中的文件多是系统级的文件，而/usr中是用户级的文件，一般与具体的系统无关。</p>
<h2 id="usr"><a href="#usr" class="headerlink" title="usr"></a>usr</h2><p>应注意，程序的配置文件、动态的数据文件等都不会存放到/usr，所以除了安装、卸载软件外，一般无需修改/usr中的内容。说在系统正常运行时，/usr甚至可以被只读挂载。由于这一特性，/usr常被划分在单独的分区，甚至有时多台计算机可以共享一个/usr。</p>
<p>/usr/bin<br>多数日常应用程序存放的位置。如果/usr被放在单独的分区中，Linux的单用户模式不能访问/usr/bin，所以对系统至关重要的程序不应放在此文件夹中。<br>/usr/include<br>存放C/C++头文件的目录<br>/usr/lib<br>系统的库文件<br>/usr/local<br>新装的系统中这个文件夹是空的，可以用于存放个人安装的软件。安装了本地软件的/usr/local里的目录结构与/usr相似<br>/usr/sbin<br>在单用户模式中不用的系统管理程序，如apache2等。<br>/usr/share<br>与架构无关的数据。多数软件安装在此。<br>/usr/X11R6<br>该目录用于保存运行X-Window所需的所有文件。该目录中还包含用于运行GUI要的配置文件和二进制文件。<br>/usr/src<br>源代码</p>
<h2 id="var"><a href="#var" class="headerlink" title="var"></a>var</h2><p>/var中包括了一些数据文件，如系统日志等。/var的存放使得/usr被只读挂载成为可能。</p>
<p>/var/cache<br>应用程序的缓存文件<br>/var/lib<br>应用程序的信息、数据。如数据库的数据等都存放在此文件夹。<br>/var/local<br>/usr/local中程序的信息、数据<br>/var/lock<br>锁文件<br>/var/log<br>日志文件<br>/var/opt<br>/opt中程序的信息、数据<br>/var/run<br>正在执行着的程序的信息，如PID文件应存放于此<br>/var/spool<br>存放程序的假脱机数据（即spool data）<br>/var/tmp<br>临时文件</p>
<blockquote>
<p>参考<a href="https://blog.csdn.net/zsg88/article/details/75209319" target="_blank" rel="noopener">linux中的/usr,/var,/opt目录详解</a><br>参考<a href="http://linux-wiki.cn/wiki/zh-hans/Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" target="_blank" rel="noopener">Linux目录结构</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/03/28/set-node-server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/03/28/set-node-server/" itemprop="url">
                  服务器配置node环境和项目
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-28T13:38:29+08:00">
                2019-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/03/28/set-node-server/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/03/28/set-node-server/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="配置node环境"><a href="#配置node环境" class="headerlink" title="配置node环境"></a>配置node环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ssh登录服务器</span><br><span class="line">ssh m@124.4.5.4</span><br><span class="line">输入密码</span><br><span class="line">cd /home/zhm/software</span><br><span class="line"><span class="meta">#</span> 下载  [wget命令是下载](http://www.cnblogs.com/peida/archive/2013/03/18/2965369.html)</span><br><span class="line"><span class="meta">#</span> 不要这个源码 编译太费劲 wget https://nodejs.org/dist/v10.15.3/node-v10.15.3.tar.gz</span><br><span class="line">wget https://nodejs.org/dist/v10.15.3/node-v10.15.3-linux-x64.tar.xz</span><br><span class="line"><span class="meta">#</span> 解压 node-v10.15.3.tar.gz被解压到当前目录，文件夹node-v10.15.3</span><br><span class="line">xz -d node-v10.15.3-linux-x64.tar.xz</span><br><span class="line"><span class="meta">#</span> 再次解压</span><br><span class="line">tar -xvf node-v10.15.3-linux-x64.tar</span><br><span class="line"><span class="meta">#</span> 拿到目录</span><br><span class="line">cd node-v10.15.3-linux-x64</span><br><span class="line"><span class="meta">#</span> 这个路径等下要用，假设这个路径是AAA  其实可以看下 ls bin就可以看到 `npm node npx`这也是为什么能用命令的原因</span><br><span class="line">pwd</span><br><span class="line"><span class="meta">#</span> npm node设置到全局 两种方式 </span><br><span class="line"><span class="meta">#</span> 软链接</span><br><span class="line"><span class="meta">#</span># 先获取PATH变量 会打印类似于 /usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin 一般会有/usr/local/bin，假设这个路径是BBB。</span><br><span class="line">echo $PATH</span><br><span class="line"><span class="meta">#</span># 我们将node和npm链接到PATH下，这样就可以执行  其实就是建立软链接。</span><br><span class="line">ln -s AAA/bin/node BBB/node</span><br><span class="line">ln -s AAA/bin/npm BBB/npm</span><br><span class="line">ln -s AAA/bin/npx BBB/npx</span><br><span class="line"><span class="meta">#</span> 永久设置（没试了）</span><br><span class="line"><span class="meta">#</span> 首先在 root 目录下找到 .bash_profile 文件，编辑，vi ~/.bash_profile 找到 PATH=$PATH:$HOME/bin，在后面添加路径为：PATH=$PATH:$HOME/bin:/usr/local/nodejs/bin保存修改，然后重载一下，source ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在任意目录下</span><br><span class="line">npm -v</span><br><span class="line">node -v</span><br><span class="line">npx -v</span><br></pre></td></tr></table></figure>
<h2 id="项目运行"><a href="#项目运行" class="headerlink" title="项目运行"></a>项目运行</h2><p>将项目放进来。 <code>nohup</code>加在一个命令的最前面，表示不挂断的运行命令。<code>&amp;</code>加载一个命令的最后面，表示这个命令放在后台执行。查看运行的命令，有两个命令可以来查看，ps 和 jobs。区别在于 jobs 只能查看当前终端后台执行的任务，换了终端就看不见了。而ps命令适用于查看瞬时进程的动态，可以看到别的终端的任务。杀掉程序 <code>kill pid号</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 让程序在后台运行</span><br><span class="line">nohup node app.js &amp;</span><br><span class="line"><span class="meta">#</span> 看下任务号 node的那个</span><br><span class="line">ps</span><br><span class="line"><span class="meta">#</span> 如果需要终止的话</span><br><span class="line">kill 21455</span><br></pre></td></tr></table></figure>
<h2 id="公钥"><a href="#公钥" class="headerlink" title="公钥"></a>公钥</h2><p>检查有没有安装ssh：<code>ssh -v</code>，安装的命令<code>ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</code>一路回车确定下就安装好了。生成在当前用户名下会有一个.sh文件。<br>检查有没有共钥： <code>ls -a ~/.ssh</code><br>生成公钥：<code>ssh-keygen</code>它先要求你确认保存公钥的位置（.ssh/id_rsa）,然后它会让你重复一个密码两次，如果不想在使用公钥的时候输入密码，可以留空。<br>打印公钥复制发给管理人员：<code>cat ~/.ssh/id_rsa.pub</code></p>
<h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>
<h2 id="远程编辑文件"><a href="#远程编辑文件" class="headerlink" title="远程编辑文件"></a>远程编辑文件</h2><p>vscode安装插件sftp；作者是liximomo。<br> .vscode 在该目录下新建一个sftp.json。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"host"</span>: <span class="string">"服务器ip地址"</span>,</span><br><span class="line">    <span class="string">"port"</span>: <span class="number">22</span>,</span><br><span class="line">    <span class="string">"username"</span>: <span class="string">"登录名"</span>,</span><br><span class="line">    <span class="string">"password"</span>: <span class="string">"登录密码"</span>,</span><br><span class="line">    <span class="string">"protocol"</span>: <span class="string">"sftp"</span>,</span><br><span class="line">    <span class="string">"agent"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"privateKeyPath"</span>: <span class="string">"存放在本地的已配置好的用于登录工作站的密钥文件（也可以是ppk文件"</span>,</span><br><span class="line">    <span class="string">"passphrase"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="string">"passive"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"interactiveAuth"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"remotePath"</span>: <span class="string">"工作站上与本地工程同步的文件夹路径，需要和本地工程文件根目录同名，且在使用sftp上传文件之前要手动在工作站上mkdir生成这个根目录"</span>,</span><br><span class="line">    <span class="string">"uploadOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"syncMode"</span>: <span class="string">"update"</span>,</span><br><span class="line">    <span class="string">"ignore"</span>: [</span><br><span class="line">        <span class="string">"**/.vscode/**"</span>,</span><br><span class="line">        <span class="string">"**/.git/**"</span>,</span><br><span class="line">        <span class="string">"**/.DS_Store"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"watcher"</span>: &#123;</span><br><span class="line">        <span class="string">"files"</span>: <span class="string">"glob"</span>,</span><br><span class="line">        <span class="string">"autoUpload"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"autoDelete"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="vim编辑器"><a href="#vim编辑器" class="headerlink" title="vim编辑器"></a>vim编辑器</h2><p>vim是从vi发展出来的一个文本编辑器。代码补完、编译及错误跳转等方便编程的功能特别丰富。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim xx.html</span><br></pre></td></tr></table></figure>
<p>进入插入模式：</p>
<p>i: 插入光标前一个字符</p>
<p>I: 插入行首</p>
<p>a: 插入光标后一个字符</p>
<p>A: 插入行未</p>
<p>o: 向下新开一行,插入行首</p>
<p>O: 向上新开一行,插入行首<br>进入命令模式：</p>
<p>ESC:从插入模式或末行模式进入命令模式</p>
<p>移动光标：</p>
<p>h: 左移 </p>
<p>j: 下移 </p>
<p>k: 上移 </p>
<p>l: 右移</p>
<p>M: 光标移动到中间行 </p>
<p>L: 光标移动到屏幕最后一行行首 </p>
<p>G: 移动到指定行,行号 -G</p>
<p>w: 向后一次移动一个字 </p>
<p>b: 向前一次移动一个字</p>
<p>{: 按段移动,上移 </p>
<p>}: 按段移动,下移</p>
<p>Ctr-d: 向下翻半屏 </p>
<p>Ctr-u: 向上翻半屏</p>
<p>Ctr-f: 向下翻一屏 </p>
<p>Ctr-b: 向上翻一屏</p>
<p>gg: 光标移动文件开头 </p>
<p>G: 光标移动到文件末尾<br>删除命令：</p>
<p>x: 删除光标后一个字符,相当于 Del </p>
<p>X: 删除光标前一个字符,相当于 Backspace</p>
<p>dd: 删除光标所在行,n dd 删除指定的行数 D: 删除光标后本行所有内容,包含光标所在字符 </p>
<p>d0: 删除光标前本行所有内容,不包含光标所在字符</p>
<p>dw: 删除光标开始位置的字,包含光标所在字符<br>撤销命令</p>
<p>u: 一步一步撤销 </p>
<p>Ctr-r: 反撤销<br>重复命令：</p>
<p>.: 重复上一次操作的命令<br>文本行移动：</p>
<blockquote>
<blockquote>
<p>: 文本行右移 </p>
</blockquote>
</blockquote>
<p>&lt;&lt;: 文本行左移<br>复制粘贴：</p>
<p>yy: 复制当前行,n yy 复制 n 行 </p>
<p>p: 在光标所在位置向下新开辟一行,粘贴<br>可视模式：</p>
<p>v: 按字符移动,选中文本 </p>
<p>V: 按行移动,选中文本可视模式可以配合 d, y, &gt;&gt;, &lt;&lt; 实现对文本块的删除,复制,左右移动<br>替换操作：</p>
<p>r: 替换当前字符 </p>
<p>R: 替换当前行光标后的字符<br>查找命令：</p>
<p>/: str查找<br>n: 下一个<br>N：上一个<br>替换命令：</p>
<p>把abc全部换成123</p>
<p>末行模式下，将光标所在行的abc替换成123<br>:%s/abc/123/g</p>
<p>末行模式下，将第一行至第10行之间的abc替换成123<br>:1, 10s/abc/123/g<br>vim里执行shell下命令：</p>
<p>末行模式里输入！，后面跟命令</p>
<blockquote>
<p><a href="https://segmentfault.com/a/1190000014826120" target="_blank" rel="noopener">linux下安装node npm并配置</a><br><a href="https://www.jianshu.com/p/abbe619070d6" target="_blank" rel="noopener">源码包</a><br><a href="https://segmentfault.com/a/1190000011844958" target="_blank" rel="noopener">vscode的sftp插件</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/21/vdom/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/21/vdom/" itemprop="url">
                  入门理解虚拟DOM以及diff算法的核心
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-21T10:44:27+08:00">
                2019-02-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/21/vdom/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/21/vdom/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul>
<li>vdom就是用js虚拟真实的dom，以此尽量减少不必要的dom操作，提高效率</li>
<li>用库使用vdom，拿snabbdom库举例说，核心api是h和patch，<code>h(&#39;div#container.two.classes&#39;, {on: {click: someFn}},[h(&#39;span&#39;, {style: {fontWeight: &#39;bold&#39;}}, &#39;This is bold&#39;)])</code>和<code>patch(container,vnode)</code></li>
<li>diff算法就是vdom找到需要更新节点的过程</li>
</ul>
<h2 id="废话"><a href="#废话" class="headerlink" title="废话"></a>废话</h2><p>开始接触虚拟dom的时候，觉得，我[略]，什么玩意，很天书啊，=。=<br>其实真正接触的时候，哦，马马虎虎，还能接受吧，反正我只是简单理解核心概念，哈哈哈，源码依旧是天书~<br>嗯呐，这边，我也是说下核心的一些概念吧，不追究细节哈，主要是为（wo）你(ye)们(bu)节(qing)省(chu)时(xi)间(jie)~<br>此文也是我接触不深的情况下写的，仅仅为了促进入门~  </p>
<h2 id="vdom是什么？为什么会存在vdom"><a href="#vdom是什么？为什么会存在vdom" class="headerlink" title="vdom是什么？为什么会存在vdom"></a>vdom是什么？为什么会存在vdom</h2><p>dom都知道是啥哈，虚拟dom字面理解那就是虚的嘛，英文virtual dom，简称vdom，嗯，定义介绍完了~  </p>
<p>你说好好的dom，干嘛弄个虚拟的，主要是因为真实的dom节点属性很多，而且dom操作很昂贵（就是耗性能），所以一般尽量能减少dom操作就减少，于是用js模拟真实dom，找出真正需要操作的部分然后再进行操作比较高效。  </p>
<p>vdom比较独立哈，独立到它自己就是一个库，用它就是模拟真实dom，减少不必要的dom操作的，后面会介绍怎么使用~  </p>
<p>举个例子理解哈~  </p>
<p>有三学生，有名有分数，给你数据，你画出个表格，然后数据变化了，于是表格也要重新变化。<br>这里就有门道了，数据变化，你可能把原表格删除重新做一个，也可以看是哪些数据变化了，再修改特定数据，你说哪种效率高~</p>
<h2 id="vdom如何应用，核心api是什么"><a href="#vdom如何应用，核心api是什么" class="headerlink" title="vdom如何应用，核心api是什么"></a>vdom如何应用，核心api是什么</h2><p>知道定义了，知道好处了，咋用呢。用库啊，哈哈哈，库有很多，我介(zhi)绍(zhidao)一个有名气的不是我写的库<a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener">snabbdom</a>，此库核心api，h和patch。h就是虚拟dom，patch可以简单理解为找到新旧节点的差别，然后有目标的更换差别。  </p>
<p>一步步说~  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- html真实的dom结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>item1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>item2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// js的盗版dom，帮助理解的</span></span><br><span class="line"><span class="keyword">var</span> vnode_i = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;<span class="attr">id</span>:<span class="string">'list'</span>&#125;,</span><br><span class="line">    children:[&#123;</span><br><span class="line">        tag:<span class="string">'li'</span>,</span><br><span class="line">        attrs:&#123;<span class="attr">classname</span>:<span class="string">'item'</span>&#125;,</span><br><span class="line">        chidren:<span class="string">'item1'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        tag:<span class="string">'li'</span>,</span><br><span class="line">        attrs:&#123;<span class="attr">classname</span>:<span class="string">'item'</span>&#125;,</span><br><span class="line">        chidren:<span class="string">'item1'</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 用h,其实这样看用法很明显，h(元素，属性，子元素)，子元素可能是数组，也可以是字符串</span></span><br><span class="line"><span class="keyword">var</span> vnode = h(<span class="string">'ul#list'</span>,&#123;&#125;,[h(&#123;<span class="attr">tag</span>:<span class="string">'li.item'</span>,&#123;&#125;,<span class="string">'item1'</span>&#125;),h(&#123;<span class="attr">tag</span>:<span class="string">'li.item'</span>,&#123;&#125;,<span class="string">'item2'</span>&#125;)])</span><br><span class="line"><span class="keyword">var</span> container = <span class="built_in">document</span>.querySelector(<span class="string">'#box'</span>)</span><br><span class="line"><span class="comment">// 用patch首个参数是真实dom,相当于填充</span></span><br><span class="line">patch(container,vnode)</span><br><span class="line"><span class="keyword">var</span> newVnode = h(<span class="string">'ul#list'</span>,&#123;&#125;,[h(&#123;<span class="attr">tag</span>:<span class="string">'li.item'</span>,&#123;&#125;,<span class="string">'item1 1111'</span>&#125;),h(&#123;<span class="attr">tag</span>:<span class="string">'li.item'</span>,&#123;&#125;,<span class="string">'item2 2222'</span>&#125;)])</span><br><span class="line"><span class="comment">// 用patch首个参数是vnode,相当于将后面一个替换掉前面的</span></span><br><span class="line">patch(vnode,newVnode)</span><br></pre></td></tr></table></figure>
<p><a href="https://codepen.io/frontzhm/pen/ZwZgQJ?editors=1000#0" target="_blank" rel="noopener">snabbdom使用的demo</a>  </p>
<h2 id="diff算法又是啥"><a href="#diff算法又是啥" class="headerlink" title="diff算法又是啥"></a>diff算法又是啥</h2><p>其实说到vdom，不可避免要提到diff算法，！！！！，是不是感觉，这又是什么鬼，snabbdom刚刚才勉强用=。=<br>哈哈哈，没有那么夸张啦，上面也提到，vdom就是找出区别，来有目标的进行操作dom，那么怎么找出区别就是diff算法啦<br>diff算法历史很悠久的啦，你想想，就是找区别，有点像以前玩的找不同游戏，linux的命令有<code>diff a文件 b文件</code>来找出两文件的区别，git也有这种，说不定你也用过<code>git diff a文件</code>，然后就会列出这文件你改前和改后的区别，<a href="http://tool.oschina.net/diff" target="_blank" rel="noopener">diff算法在线工具</a>也可以玩玩，是不是感觉，这样diff算法亲和了很多~<br>当然，snabbdom的diff算法，特指找出需要更新的节点，实现很复杂，这边单纯的简单说下核心的一些东西。<br>两个方面：<code>patch(container,vnode)</code>和<code>patch(vnode,newVnode)</code>,即虚拟dom如何变成真实的dom，然后插入到特定的container里和节点怎么更新~  </p>
<h3 id="虚拟dom如何变成真实的dom"><a href="#虚拟dom如何变成真实的dom" class="headerlink" title="虚拟dom如何变成真实的dom"></a>虚拟dom如何变成真实的dom</h3><p>再看下，虚拟dom怎么写的，注意这边强调的是实现的逻辑，是逻辑代码，仅仅帮助理解的~</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vnode_i = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;<span class="attr">id</span>:<span class="string">'list'</span>&#125;,</span><br><span class="line">    children:[&#123;</span><br><span class="line">        tag:<span class="string">'li'</span>,</span><br><span class="line">        attrs:&#123;<span class="attr">classname</span>:<span class="string">'item'</span>&#125;,</span><br><span class="line">        chidren:<span class="string">'item1'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        tag:<span class="string">'li'</span>,</span><br><span class="line">        attrs:&#123;<span class="attr">classname</span>:<span class="string">'item'</span>&#125;,</span><br><span class="line">        chidren:<span class="string">'item2'</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">vnode</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 创建元素</span></span><br><span class="line">    <span class="keyword">var</span> ele = <span class="built_in">document</span>.createElement(vnode.tag)</span><br><span class="line">    <span class="keyword">var</span> attrs = vnode.attrs || &#123;&#125;</span><br><span class="line">    <span class="comment">// children会有字符串的情况，这里只是缕下逻辑，不详细展开描述</span></span><br><span class="line">    <span class="keyword">var</span> children = vnode.children || []</span><br><span class="line">    <span class="comment">// 将元素属性一个个挂载上去</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> attrs)&#123;</span><br><span class="line">        <span class="keyword">if</span>(attrs.hasOwnProperty(key))&#123;</span><br><span class="line">            ele[key] = attrs[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将元素的子元素再添加进去</span></span><br><span class="line">    children.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">child</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 这里的child仍然是虚拟节点，需要变成真实节点</span></span><br><span class="line">        <span class="keyword">var</span> childNode = createElement(child)</span><br><span class="line">        <span class="comment">// 因为只有真实节点才能添加哇~</span></span><br><span class="line">        ele.appendChild(childNode)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> ele</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>真实的dom写出来之后，插入到特定container里这个大家都知道的哈~</p>
<h3 id="节点怎么更新"><a href="#节点怎么更新" class="headerlink" title="节点怎么更新"></a>节点怎么更新</h3><p>当节点已经存在的情况下，此时该节点发生一些变化，怎么将原节点替换掉</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vnode_new = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;<span class="attr">id</span>:<span class="string">'list'</span>&#125;,</span><br><span class="line">    children:[&#123;</span><br><span class="line">        tag:<span class="string">'li'</span>,</span><br><span class="line">        attrs:&#123;<span class="attr">classname</span>:<span class="string">'item'</span>&#125;,]</span><br><span class="line">        <span class="comment">// 这里发生了变化</span></span><br><span class="line">        chidren:<span class="string">'item1 1111'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        tag:<span class="string">'li'</span>,</span><br><span class="line">        attrs:&#123;<span class="attr">classname</span>:<span class="string">'item'</span>&#125;,</span><br><span class="line">        chidren:<span class="string">'item2'</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateChildren</span>(<span class="params">vnode,newVnode</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 这边暂时只考虑children不同的情况，不考虑tag和attrs</span></span><br><span class="line">    <span class="keyword">var</span> children = vnode.children || []</span><br><span class="line">    <span class="keyword">var</span> newChildren = newVnode.children || []</span><br><span class="line">    <span class="comment">// 将子元素一个个比较</span></span><br><span class="line">    children.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">child,index</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 比较的对象</span></span><br><span class="line">        <span class="keyword">var</span> newChild = child[index]</span><br><span class="line">        <span class="keyword">if</span>(child.tag === newChild.tag)&#123;</span><br><span class="line">            <span class="comment">// 标签相同，attr不考虑的话，就相当于再次比较child的children和newChild的children</span></span><br><span class="line">            updateChildren(child,newChild)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 标签不同的话，直接替换掉原来child的真实节点</span></span><br><span class="line">            <span class="keyword">var</span> newChildNode = createElement(newChild)</span><br><span class="line">            <span class="comment">// childNode已经是真实的dom了，这边只需要获取</span></span><br><span class="line">            <span class="keyword">var</span> childNode = vnode.elm</span><br><span class="line">            <span class="comment">// 替换掉</span></span><br><span class="line">            childNode.parentNode.replaceChild(newChildNode,childNode)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<!-- 



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = [&#123;<span class="attr">name</span>:<span class="string">'李三'</span>，age:<span class="number">23</span>,<span class="attr">name</span>:<span class="string">'王三'</span>，age:<span class="number">24</span>&#125;]</span><br><span class="line"><span class="comment">// 表格展现数据，数据变化表格跟着变化</span></span><br><span class="line"><span class="comment">// jquery实现的逻辑，div放html，然后render(data)，btn.onclick = function()&#123;数据设置新的，重新render(data)&#125;，render函数就是清空以前的html然后重新将数据放进来，一旦数据修改，这样修改很低效，我们需要知道哪个dom需要变化，相应的改变这个节点即可</span></span><br><span class="line"><span class="comment">// 这样的缺点：</span></span><br><span class="line"><span class="comment">// 真实的dom属性超级多，dom操作是昂贵的，js效率运行高</span></span><br><span class="line"><span class="comment">// 尽量减少dom操作，而不是推倒重来</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// virtual dom 用js模拟dom结构，将dom对比层放在js层，提高效率,模拟的dom的属性很简单</span></span><br></pre></td></tr></table></figure>
<h2 id="vdom如何应用，核心api是什么-1"><a href="#vdom如何应用，核心api是什么-1" class="headerlink" title="vdom如何应用，核心api是什么"></a>vdom如何应用，核心api是什么</h2><ul>
<li>介绍snabbdom库，著名实现vdom的库</li>
<li>重做之前的demo</li>
<li>核心api</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item1"</span>&gt;</span>Item1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item2"</span>&gt;</span>Item2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以简单的虚拟</span></span><br><span class="line"><span class="keyword">let</span> vnode = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;</span><br><span class="line">        id:<span class="string">'list'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item1'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item1'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item2'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item2'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//引用库 bootcdn  snabbdom   =&gt; snabbdom.js+snabbdom-class.js+snabbdom-props.js+snabbdom-style.js+snabbdom-eventlisteners.js+h.js</span></span><br><span class="line">let vnode2 = h(ul#list,&#123;&#125;,[h(li.item1,&#123;&#125;,'item1'),h(li.item2,&#123;&#125;,'item2')])</span><br><span class="line">patch(container,vnode2)</span><br><span class="line">let vnode2_modify = h(ul#list,&#123;&#125;,[h(li.item1,&#123;&#125;,'item1 1111'),h(li.item2,&#123;&#125;,'item2 2222')])</span><br><span class="line">patch(vnode2,vnode2_modify)</span><br></pre></td></tr></table></figure>
<h2 id="介绍diff算法（60-70-的代码）"><a href="#介绍diff算法（60-70-的代码）" class="headerlink" title="介绍diff算法（60%-70%的代码）"></a>介绍diff算法（60%-70%的代码）</h2><p>###什么是diff算法</p>
<p>一直存在~<br>linux基本命令<br>linux的命令<code>diff log1.txt log2.txt</code><br>git命令<code>git diff 某文件</code><br><a href="http://tool.oschina.net/diff">diff在线对比</a></p>
<p>###去繁就简</p>
<p>diff很复杂，实现难度大，源码量很大<br>去繁就简，讲明白核心流程，不关注细节（28原则 20%的功能满足80%的需求，这也是看其他库的原则，不能一行行看）<br>面试官也不清楚细节，但关注核心流程</p>
<p>###vdom为什么用diff算法</p>
<p>dom操作是昂贵的、尽量减少DOM操作<br>找出必须更新的节点，其他的不更新<br>这个找出的过程，就是diff算法</p>
<p>vdom应用diff算法就是为了找出需要更新的节点</p>
<p>###diff算法的实现流程</p>
<p>核心算法createElement updateChildren</p>
<p>####patch(container,vnode)</p>
<p>实现vnode变成真实dom<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以简单的虚拟</span></span><br><span class="line"><span class="keyword">let</span> vnode = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;</span><br><span class="line">        id:<span class="string">'list'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item1'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item1'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item2'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item2'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 让vnode变成真实dom</span></span><br><span class="line"><span class="comment">// ...createElement(vnode)</span></span><br></pre></td></tr></table></figure></p>
<h4 id="patch-vnode-newVnode"><a href="#patch-vnode-newVnode" class="headerlink" title="patch(vnode,newVnode)"></a>patch(vnode,newVnode)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以简单的虚拟</span></span><br><span class="line"><span class="keyword">let</span> vnode = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;</span><br><span class="line">        id:<span class="string">'list'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item1'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item2'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> vnode2 = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;</span><br><span class="line">        id:<span class="string">'list'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item1'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item2222'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item222'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item3'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 比较新旧区别</span></span><br><span class="line"><span class="comment">// function updateChildren(vnode,newVnode)</span></span><br></pre></td></tr></table></figure>
<p>节点新增和删除<br>节点重新排序<br>节点属性 样式 事件绑定<br>如何极致压榨性能</p>
<p><code>`</code></p>
<p> –&gt;</p>
-->
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/20/node_base/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/20/node_base/" itemprop="url">
                  虚拟DOM
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-20T16:29:09+08:00">
                2019-02-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/20/node_base/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/20/node_base/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><p>vdom比较独立，使用也比较简单</p>
<h2 id="vdom是什么？为什么会存在vdom"><a href="#vdom是什么？为什么会存在vdom" class="headerlink" title="vdom是什么？为什么会存在vdom"></a>vdom是什么？为什么会存在vdom</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = [&#123;<span class="attr">name</span>:<span class="string">'李三'</span>，age:<span class="number">23</span>,<span class="attr">name</span>:<span class="string">'王三'</span>，age:<span class="number">24</span>&#125;]</span><br><span class="line"><span class="comment">// 表格展现数据，数据变化表格跟着变化</span></span><br><span class="line"><span class="comment">// jquery实现的逻辑，div放html，然后render(data)，btn.onclick = function()&#123;数据设置新的，重新render(data)&#125;，render函数就是清空以前的html然后重新将数据放进来，一旦数据修改，这样修改很低效，我们需要知道哪个dom需要变化，相应的改变这个节点即可</span></span><br><span class="line"><span class="comment">// 这样的缺点：</span></span><br><span class="line"><span class="comment">// 真实的dom属性超级多，dom操作是昂贵的，js效率运行高</span></span><br><span class="line"><span class="comment">// 尽量减少dom操作，而不是推倒重来</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// virtual dom 用js模拟dom结构，将dom对比层放在js层，提高效率,模拟的dom的属性很简单</span></span><br></pre></td></tr></table></figure>
<h2 id="vdom如何应用，核心api是什么"><a href="#vdom如何应用，核心api是什么" class="headerlink" title="vdom如何应用，核心api是什么"></a>vdom如何应用，核心api是什么</h2><ul>
<li>介绍snabbdom库，著名实现vdom的库</li>
<li>重做之前的demo</li>
<li>核心api</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item1"</span>&gt;</span>Item1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item2"</span>&gt;</span>Item2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以简单的虚拟</span></span><br><span class="line"><span class="keyword">let</span> vnode = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;</span><br><span class="line">        id:<span class="string">'list'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item1'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item1'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item2'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item2'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//引用库 bootcdn  snabbdom   =&gt; snabbdom.js+snabbdom-class.js+snabbdom-props.js+snabbdom-style.js+snabbdom-eventlisteners.js+h.js</span></span><br><span class="line">let vnode2 = h(ul#list,&#123;&#125;,[h(li.item1,&#123;&#125;,'item1'),h(li.item2,&#123;&#125;,'item2')])</span><br><span class="line">patch(container,vnode2)</span><br><span class="line">let vnode2_modify = h(ul#list,&#123;&#125;,[h(li.item1,&#123;&#125;,'item1 1111'),h(li.item2,&#123;&#125;,'item2 2222')])</span><br><span class="line">patch(vnode2,vnode2_modify)</span><br></pre></td></tr></table></figure>
<h2 id="介绍diff算法（60-70-的代码）"><a href="#介绍diff算法（60-70-的代码）" class="headerlink" title="介绍diff算法（60%-70%的代码）"></a>介绍diff算法（60%-70%的代码）</h2><p>###什么是diff算法</p>
<p>一直存在~<br>linux基本命令<br>linux的命令<code>diff log1.txt log2.txt</code><br>git命令<code>git diff 某文件</code><br><a href="http://tool.oschina.net/diff" target="_blank" rel="noopener">diff在线对比</a></p>
<p>###去繁就简</p>
<p>diff很复杂，实现难度大，源码量很大<br>去繁就简，讲明白核心流程，不关注细节（28原则 20%的功能满足80%的需求，这也是看其他库的原则，不能一行行看）<br>面试官也不清楚细节，但关注核心流程</p>
<p>###vdom为什么用diff算法</p>
<p>dom操作是昂贵的、尽量减少DOM操作<br>找出必须更新的节点，其他的不更新<br>这个找出的过程，就是diff算法</p>
<p>vdom应用diff算法就是为了找出需要更新的节点</p>
<p>###diff算法的实现流程</p>
<p>核心算法createElement updateChildren</p>
<p>####patch(container,vnode)</p>
<p>实现vnode变成真实dom<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以简单的虚拟</span></span><br><span class="line"><span class="keyword">let</span> vnode = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;</span><br><span class="line">        id:<span class="string">'list'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item1'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item1'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item2'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item2'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 让vnode变成真实dom</span></span><br><span class="line"><span class="comment">// ...createElement(vnode)</span></span><br></pre></td></tr></table></figure></p>
<h4 id="patch-vnode-newVnode"><a href="#patch-vnode-newVnode" class="headerlink" title="patch(vnode,newVnode)"></a>patch(vnode,newVnode)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以简单的虚拟</span></span><br><span class="line"><span class="keyword">let</span> vnode = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;</span><br><span class="line">        id:<span class="string">'list'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item1'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item2'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> vnode2 = &#123;</span><br><span class="line">    tag:<span class="string">'ul'</span>,</span><br><span class="line">    attrs:&#123;</span><br><span class="line">        id:<span class="string">'list'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    children:[</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item1'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item2222'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item222'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        &#123;</span><br><span class="line">            tag:<span class="string">'li'</span>,</span><br><span class="line">            attrs:&#123;</span><br><span class="line">                classname:<span class="string">'item'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            children:[<span class="string">'Item3'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 比较新旧区别</span></span><br><span class="line"><span class="comment">// function updateChildren(vnode,newVnode)</span></span><br></pre></td></tr></table></figure>
<p>节点新增和删除<br>节点重新排序<br>节点属性 样式 事件绑定<br>如何极致压榨性能</p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/02/20/node_base/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/15/promise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/15/promise/" itemprop="url">
                  未命名
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-15T16:05:11+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/promise/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/promise/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            const PENDING = "pending";
const FULFILLED = "fulfilled";
const REJECTED = "rejected";
// 实现Promise的类
function Promise(executor) {
  // 缓存当前Promise实例
  let self = this;
  // 设置状态
  self.status = PENDING;
  // 定义存放成功的回调数组
  self.onResolvedCallbacks = [];
  // 定义存放失败的回调数组
  self.onRejectedCallbacks = [];
  // 调用此方法的时候，状态是pending的时候转成fulfilled，否则不执行
  function resolve(value) {
    if (value instanceof Promise) {
      return value.then(resolve, reject);
    }
    if (self.status === PENDING) {
      self.status = FULFILLED;
      // 成功后会得到一个值不能修改
      self.value = value;
      // 调用所有成功的回调
      self.onResolvedCallbacks.forEach(cb => cb(self.value));
    }
  }
  // 调用此方法的时候，状态是pending的时候转成rejected，否则不执行
  function reject(reason) {
    if (self.status === PENDING) {
      self.status = REJECTED;
      // 成功后会得到一个值不能修改
      self.value = reason;
      // 调用所有成功的回调
      self.onRejectedCallbacks.forEach(cb => cb(self.reason));
    }
  }
  try {
    // 函数执行可能会出错，所以需要捕获
    executor(resolve, reject);
  } catch (e) {
    reject(e);
  }
}
// 值的穿透 then(function(data){..},function(e){..})
Promise.prototype.then = function(onFulfilled, onReject) {
  onFulfilled =
    typeof onFulfilled === "function" ? onFulfilled : value => value;
  onRejected =
    typeof onRejected === "function"
      ? onRejected
      : reason => {
          throw reason;
        };
  let self = this;
  let promise2;
  if (self.status === FULFILLED) {
    return new Promise(function(resolve, reject) {
      setTimeout(function() {
        try {
          let x = onFulfilled(self.value);
          // 如果获取到了返回值 会走解析promise的过程
          resolvePromise(promise2, x, resolve, reject);
        } catch (e) {
          reject(e);
        }
      });
    });
  }
  if (self.status === REJECTED) {
    setTimeout(function() {
      try {
        let x = onRejected(self.value);
        resolvePromise(promise2, x, resolve, reject);
      } catch (e) {
        reject(e);
      }
    });
  }
  if (self.status === PENDING) {
    setTimeout(function() {
      try {
        self.onResolvedCallbacks.push(function() {
          let x = onFulfilled(self.value);
          resolvePromise(promise2, x, resolve, reject);
        });
      } catch (e) {
        reject(e);
      }
    });

    setTimeout(function() {
      try {
        self.onRejectedCallbacks.push(function() {
          let x = onRejected(self.value);
          resolvePromise(promise2, x, resolve, reject);
        });
      } catch (e) {
        reject(e);
      }
    });
  }
};

function resolvePromise(promise2, x, resolve, reject) {
  /**
   * let p2 = p1.then(data=>{return p2})
   */
  if (promise2 === x) {
    return reject(new TypeError("循环引用"));
  }
  let called = false; // promise2是否被pended
  // if(x instanceof Promise){
  //     if(x.status === PENDING){
  //         x.then(function(y){
  //             resolvePromise(promise2,y,resolve,reject)
  //         },reject)
  //     }else{
  //         x.then(resolve,reject)
  //     }
  //     // x是thenable对象
  // }else
  if (x !== null && (typeof x === "object" || typeof x === "function")) {
    try {
      let then = x.then;
      // 有些promise会同时执行resolve reject 所以加个called
      if (typeof then === "function") {
        if (called) {
          return;
        }
        called = true;
        then.call(
          x,
          function(y) {
            resolvePromise(promise2, y, resolve, reject);
          },
          function(err) {
            reject(err);
          }
        );
      }
    } catch (e) {
      reject(e);
    }
  } else {
    // x是普通值
    resolve(x);
  }
}
Promise.prototype.catch = function(onRejected) {
  this.then(null, onRejected);
};
Promise.prototype.deferred = Promise.defer = function(onRejected) {
  let defer = {};
  defer.promise = new Promise(function(resolve, reject) {
    defer.resolve = resolve;
    defer.reject = reject;
  });
  return defer;
};
// console.time('cost') console.timeEnd('cost')
// promise数组，全部成功才会执行下一步
// 同时异步请求多个数据的时候
Promise.all = function(arr) {
  let n = [];
  let len = arr.length;
  let result;
  arr.forEach(item => {
    item
      .then(() => {
        n.push(true);
        if (n.length === len) {
        }
      })
      .catch(() => {
        n.push(false);
      });
  });
  return new Promise(function(resolve, reject) {
    promises.forEach(promise => {
      promise.then();
    });
  });
};
function gen(times, cb) {
  let result = [],
    count = 0;
  return function(i, data) {
    result[i] = data;
    if (count++ === times) {
      cb(result);
    }
  };
}

Promise.all = function(promises) {
  return new Promise((resolve, reject) => {
    const len = promises.length;
    let done = gen(len, resolve);
    for (let i = 0; i < len; i++) {
      // const cur = promises[i];
      promises[i].then(function(data) {
        done(i, data);
      }, reject);
      // promises[i].then(done.bind(null,i,data))
    }
  });
};
Promise.race = function(promises) {
  return new Promise((resolve, reject) => {
    const len = promises.length;
    let done = gen(len, resolve);
    for (let i = 0; i < len; i++) {
      // const cur = promises[i];
      promises[i].then(resolve, reject);
      // promises[i].then(done.bind(null,i,data))
    }
  });
};

// let Q = require('q') // npm i q
// 分析下Q
let Q = {
  defer() {
    let success, error;
    return {
      reject(err) {
        error(err);
      },
      resolve(data) {
        success(data);
      },
      promise: {
        then(onFulfilled, onRejected) {
          success = onFulfilled;
          error = onRejected;
        }
      }
    };
  }
};
let fs = require("fs");
function readFile(filename) {
  let defer = Q.defer();
  fs.readFile(filename, "utf8", function(err, data) {
    if (err) {
      defer.reject(err);
    } else {
      defer.resolve(data);
    }
  });
  return defer.promise;
}
readFile("./1.txt").then(data => {
  console.log(data);
});

// bluebird是世界上最快的库
// 它能把任意通过回调函数实现的异步API换成promiseApi
let Promise = require("bluebird");
let fs = require("fs");
// 遍历对象上所有的方法 然后对每个方法添加一个新的方法 Async
fs.readFileAsync("./1.txt", "utf8").then(data => {
  console.log(data);
});
Promise.promisifyAll(fs);
let readFile = require("fs").readFile;
let readFileSync = Promise.promisify(readFile);
function promisify(fn) {
  return function(...args) {
    return new Promise((resolve, reject) => {
      fn.apply(null, [
        ...args,
        function(err, data) {
          err ? reject(err) : resolve(data);
        }
      ]);
    });
  };
}
function promisifyAll(object) {
  for (const key in object) {
    if (object.hasOwnProperty(key)) {
      // const element = object[key];
      if (typeof key === "function") {
        object[key + "Aynsc"] = promisify(object[key]);
      }
    }
  }
}
readFileSync("./1.txt", "utf8").then(data => {
  console.log(data);
});

function readFile(filename) {
  return new Promise(function(resolve, reject) {
    fs.readFile(filename, "utf8", function(err, data) {
      err ? reject(err) : resolve(data);
    });
  });
}

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/15/1_async_history/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/02/15/1_async_history/" itemprop="url">
                  异步的发展，顺手学会怎么处理并发请求
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-15T11:31:58+08:00">
                2019-02-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/15/1_async_history/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/15/1_async_history/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul>
<li>异步：先干一件事，中间去干其他的事，最终再回来干这件事</li>
<li>高阶函数是函数作为参数或者函数作为返回值 ，作用是批量生成函数和预置函数做为参数（可以缓存函数，当达到条件时执行该函数）</li>
<li>异步的发展流程：callback -&gt;  promise -&gt; generator + co -&gt; async+await(语法糖)</li>
<li>回调函数金字塔处理多请求 -&gt; 哨兵函数处理多请求 -&gt; promise处理多请求 -&gt; co处理多请求 -&gt; async处理多请求</li>
<li>手写实现co、bluebird的promisify和promisifyAll</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2019/02/15/1_async_history/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/06/cnzz/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/09/06/cnzz/" itemprop="url">
                  网站加cnzz
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-06T09:58:54+08:00">
                2018-09-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/统计/" itemprop="url" rel="index">
                    <span itemprop="name">统计</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/06/cnzz/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/09/06/cnzz/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="cnzz"><a href="#cnzz" class="headerlink" title="cnzz"></a>cnzz</h1><p>cnzz就是统计数据用的，统计pv，uv，甚至某个按钮的点击次数。</p>
<h2 id="网站的添加步骤"><a href="#网站的添加步骤" class="headerlink" title="网站的添加步骤"></a>网站的添加步骤</h2><ol>
<li><a href="https://web.umeng.com" target="_blank" rel="noopener">去网站注册账号</a>，然后添加网站</li>
<li>获取代码，在body前添加脚本，注意一个域名对应一个id，也就是一个域名对应一个脚本</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//s22.cnzz.com/z_stat.php?id=你的id&amp;web_id=你的id"</span> <span class="attr">language</span>=<span class="string">"JavaScript"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>网站上会显示站长统计四个字或者图标，嫌不好看的话,我用的是字</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-attr">[title=站长统计]</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">visibility</span>: hidden;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="事件的统计"><a href="#事件的统计" class="headerlink" title="事件的统计"></a>事件的统计</h2><ol>
<li><p><a href="http://open.cnzz.com/a/new/trackevent/" target="_blank" rel="noopener">某个按钮的点击次数统计的话</a>，先上面的步骤，然后</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 记得添加id</span></span><br><span class="line">someElement.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    _czc.push([<span class="string">'_trackEvent'</span>, <span class="string">'今日头条里点击下载app次数'</span>, <span class="string">'下载'</span>, <span class="string">'app'</span>,<span class="string">'5'</span>,<span class="string">'wx-share'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 具体介绍:<br> 各参数含义如下：<br> category：事件类别，必填项，表示事件发生在谁身上，如“视频”、“小说”、“轮显层”等等。<br> action：事件操作，必填项，表示访客跟元素交互的行为动作，如”播放”、”收藏”、”翻层”等等。<br> label：事件标签，选填项，用于更详细的描述事件，从各个方面都可以，比如具体是哪个视频，哪部小说，翻到了第几层等等。<br> value：事件值，选填项，整数型，用于填写打分型事件的分值，加载时间型事件的时长，订单型事件的价格等等。<br> nodeid：div元素id，选填项，填写网页中的div元素id值，用于在“用户视点”功能上重绘元素的事件发生情况。<br> 查看API详细说明</p>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_czc.push([<span class="string">"_trackEvent"</span>,category,action,label,value,nodeid]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>记得左上角下拉箭头切换不同域名，以及左侧菜单栏的受访页面可以进行搜索，也可以右上角站点设置里排除某些页面和ip</p>
</li>
</ol>
<h2 id="改进的代码"><a href="#改进的代码" class="headerlink" title="改进的代码"></a>改进的代码</h2><p>因为经常在测试和正式环境切换,而且每次加css样式隐藏图标也是神烦. 稍微改进一丢丢.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * cnzz数据统计</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> isProduction = <span class="regexp">/正式域名/</span>.test(<span class="built_in">window</span>.location.href)</span><br><span class="line"><span class="comment">// !!!域名和脚本id必须一一对应</span></span><br><span class="line"><span class="keyword">var</span> productionCnzzId = <span class="string">'12899668'</span></span><br><span class="line"><span class="keyword">var</span> testCnzzId = <span class="string">'126326337'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> statScript = <span class="built_in">document</span>.body.appendChild(<span class="built_in">document</span>.createElement(<span class="string">'script'</span>))</span><br><span class="line">statScript.src = isProduction ? (<span class="string">'//s22.cnzz.com/z_stat.php?id='</span>+productionCnzzId+<span class="string">'&amp;web_id='</span>+productionCnzzId) : (<span class="string">'//s22.cnzz.com/z_stat.php?id='</span>+testCnzzId+<span class="string">'&amp;web_id='</span>+testCnzzId)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 用延时是因为cnzz脚本插入需要时间</span></span><br><span class="line">    statScript.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 隐藏统计字</span></span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">'a[title="站长统计"]'</span>).style.cssText = <span class="string">'position: absolute; visibility: hidden; bottom: 0; z-index: -1;'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/06/promise2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/09/06/promise2/" itemprop="url">
                  promise再总结总结
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-06T09:58:54+08:00">
                2018-09-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/06/promise2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/09/06/promise2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h1><p>语法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p>对XHPHttpRequest的封装<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Return a new promise.</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Do the usual XHR stuff</span></span><br><span class="line">    <span class="keyword">var</span> req = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    req.open(<span class="string">'GET'</span>, url);</span><br><span class="line"></span><br><span class="line">    req.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// This is called even on 404 etc</span></span><br><span class="line">      <span class="comment">// so check the status</span></span><br><span class="line">      <span class="keyword">if</span> (req.status == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">// Resolve the promise with the response text</span></span><br><span class="line">        resolve(req.response);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Otherwise reject with the status text</span></span><br><span class="line">        <span class="comment">// which will hopefully be a meaningful error</span></span><br><span class="line">        reject(<span class="built_in">Error</span>(req.statusText));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle network errors</span></span><br><span class="line">    req.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      reject(<span class="built_in">Error</span>(<span class="string">"Network Error"</span>));</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make the request</span></span><br><span class="line">    req.send();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>改良版:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fetch(url)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getJSON</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> get(url).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;response.json()&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="回调函数单参数的处理"><a href="#回调函数单参数的处理" class="headerlink" title="回调函数单参数的处理"></a>回调函数单参数的处理</h2><p>比如:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">oneParam</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> data.toString()</span><br><span class="line">&#125;</span><br><span class="line">getJSON(url1).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> oneParam(data)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 简化为,接下去的值就是oneParam(data)</span></span><br><span class="line">getJSON(url1).then(oneParam)</span><br></pre></td></tr></table></figure></p>
<h2 id="扩充下回调函数参数个数的问题"><a href="#扩充下回调函数参数个数的问题" class="headerlink" title="扩充下回调函数参数个数的问题"></a>扩充下回调函数参数个数的问题</h2><p>其实遇到回调函数有时候自带参数,有时候不带参数,有时候有一个参数,有时候有多个参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fn()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>仔细看上面的,其实 <code>a(fn)</code>等价于<code>fn()</code></p>
<p>常用在数组里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item ++</span><br><span class="line">&#125;</span><br><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> log(item)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 简化为</span></span><br><span class="line">arr.forEach(log)</span><br><span class="line"><span class="comment">// 同理</span></span><br><span class="line">arr.map(log)</span><br></pre></td></tr></table></figure>
<h2 id="并发请求的处理"><a href="#并发请求的处理" class="headerlink" title="并发请求的处理"></a>并发请求的处理</h2><p>假设story.json的内容是<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"heading"</span>: <span class="string">"&lt;h1&gt;A story about something&lt;/h1&gt;"</span>,</span><br><span class="line">  <span class="string">"chapterUrls"</span>: [</span><br><span class="line">    <span class="string">"chapter-1.json"</span>,</span><br><span class="line">    <span class="string">"chapter-2.json"</span>,</span><br><span class="line">    <span class="string">"chapter-3.json"</span>,</span><br><span class="line">    <span class="string">"chapter-4.json"</span>,</span><br><span class="line">    <span class="string">"chapter-5.json"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="forEach的坑"><a href="#forEach的坑" class="headerlink" title="forEach的坑"></a>forEach的坑</h3><p>首先想到forEach</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">'story.json'</span>)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// return res.chapterUrls.forEach(url=&gt;getJSON(url).then(content=&gt;addToHtml(content)))</span></span><br><span class="line">    <span class="comment">// 还记得单参数的事吧</span></span><br><span class="line">    <span class="keyword">return</span> res.chapterUrls.forEach(<span class="function"><span class="params">url</span>=&gt;</span>getJSON(url).then(addToHtml))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这里的坑在于发出请求了,但是因为响应时间不一定,所以插入的时候可能章节2在章节1前面</p>
<h3 id="用用map和Promise-all"><a href="#用用map和Promise-all" class="headerlink" title="用用map和Promise.all"></a>用用map和Promise.all</h3><p>组成一个promise的数组,等到都下载都完成了再添加到html中.<br>Promise.all就是所有promise都变成fulfilled状态了才继续.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">'story.json'</span>)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// return res.chapterUrls.forEach(url=&gt;getJSON(url).then(content=&gt;addToHtml(content)))</span></span><br><span class="line">    <span class="comment">// 还记得单参数的事吧</span></span><br><span class="line">    <span class="comment">// return Promise.all(res.chapterUrls.map(url=&gt;getJSON(url)))</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.all(res.chapterUrls.map(getJSON))</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">resArr</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// resArr.forEach(charter=&gt;addToHtml(charter))</span></span><br><span class="line">    resArr.forEach(addToHtml)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>但这里还有个不尽如人意的地方,就是虽然并发请求,但是等到所有请求结果了才继续下一步,理想情况是章节1结果来了直接显示,章节2结果来了只要章节1来了就可以显示,以此类推</p>
<h3 id="用用迭代"><a href="#用用迭代" class="headerlink" title="用用迭代"></a>用用迭代</h3><p>先说说简单的迭代<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">var</span> sum</span><br><span class="line">arr.forEach(<span class="function"><span class="params">item</span>=&gt;</span>sum+=item)</span><br><span class="line"><span class="comment">// 每经过一项就进行加,变成新的sum</span></span><br><span class="line">arr.reduce(<span class="function">(<span class="params">sum,item</span>)=&gt;</span>(sum+item),sum)</span><br></pre></td></tr></table></figure></p>
<p>这里针对请求可以这样</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sequence = <span class="built_in">Promise</span>.resolve()</span><br><span class="line">getJSON(<span class="string">'story.json'</span>)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.chapterUrls.map(getJSON).then(<span class="function"><span class="keyword">function</span>(<span class="params">promiseArr</span>)</span>&#123;</span><br><span class="line">        promiseArr.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">promise</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 第一个promise变成fulfilled之后就添加到html</span></span><br><span class="line">            <span class="comment">// 此时sequence变成以下,只有then的状态完成了才能继续下一个addToHtml</span></span><br><span class="line">            sequence = sequence.then(<span class="function"><span class="keyword">function</span>(<span class="params">promise</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> promise</span><br><span class="line">            &#125;).then(addToHtml)</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>用reduce改写下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">getJSON(<span class="string">'story.json'</span>)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> res.chapterUrls.map(getJSON).then(<span class="function"><span class="keyword">function</span>(<span class="params">promiseArr</span>)</span>&#123;</span><br><span class="line">        promiseArr.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">sequence,promise</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 第一个promise变成fulfilled之后就添加到html</span></span><br><span class="line">            <span class="comment">// 此时sequence变成以下,只有then的状态完成了才能继续下一个addToHtml</span></span><br><span class="line">            <span class="keyword">return</span> sequence.then(<span class="function"><span class="keyword">function</span>(<span class="params">promise</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> promise</span><br><span class="line">            &#125;).then(addToHtml)</span><br><span class="line">        &#125;,<span class="built_in">Promise</span>.resolve())</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="以上来源于google的文档"><a href="#以上来源于google的文档" class="headerlink" title="以上来源于google的文档"></a>以上来源于google的文档</h2><p>可以看<a href="https://developers.google.cn/web/fundamentals/primers/promises#xmlhttprequest_promise" target="_blank" rel="noopener">google的文档</a>.<br><a href="https://github.com/googlesamples/web-fundamentals/tree/gh-pages/fundamentals/primers" target="_blank" rel="noopener">例子在github</a></p>
<p>说下小白的步步操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/googlesamples/web-fundamentals</span><br><span class="line">cd web-fundamentals</span><br><span class="line">npm install anywhere -g</span><br><span class="line">anywhere</span><br><span class="line"><span class="meta">#</span> 点击具体的文件就可以看到效果了如async-best-example.html</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://omizt4opc.bkt.clouddn.com/avatar.jpg"
               alt="frontzhm" />
          <p class="site-author-name" itemprop="name">frontzhm</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">70</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">frontzhm</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"frontzhm"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


  

</body>
</html>
