<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="frontzhm, zhm, huahua, hua_hua" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="hello world">
<meta property="og:type" content="website">
<meta property="og:title" content="花花的博客">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="花花的博客">
<meta property="og:description" content="hello world">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="花花的博客">
<meta name="twitter:description" content="hello world">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title> 花花的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?60f2cb5747a596a24f2a053f1650c30b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">花花的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/19/vue-props-emit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/11/19/vue-props-emit/" itemprop="url">
                  props/$emit、v-model、.sync的适用场景 -- vue组件通信系列
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-19T11:29:06+08:00">
                2020-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/11/19/vue-props-emit/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/11/19/vue-props-emit/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>vue组件的数据通信方式很多，本篇着重讲<code>props/$emit</code>，神助是<code>v-model/.sync</code>语法糖。</p>
<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul>
<li>props/$emit是父子组件最常用的通信方式，而v-model、.sync只是其语法糖</li>
<li>子组件只是单一的修改某个父组件值的话，表单类组件使用<code>v-model</code>语法糖</li>
<li>子组件只是单一的修改某个父组件值的话，非表单类组件使用<code>sync</code>语法糖</li>
<li>复杂逻辑还是老老实实<code>props/$emit</code></li>
</ul>
<p>其实语法糖只是在父组件用的时候更加方便，而子组件该咋样还是咋样。</p>
<h2 id="props-emit"><a href="#props-emit" class="headerlink" title="props/$emit"></a>props/$emit</h2><p>子组件想要显示父组件的数据，就<code>props</code>。<br>子组件想要改变父组件的数据，就<code>$emit</code>。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/382a866b60f8419088a0186632324e7f~tplv-k3u1fbpfcp-zoom-1.image" alt="props_emit"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/104e6728f2824c11a15988582de20c58~tplv-k3u1fbpfcp-zoom-1.image" alt="props_emit"></p>
<p>留意的点：</p>
<ul>
<li>子组件props里定义的属性名和父组件里的一一对应，注意父组件使用属性的时候用<strong>羊肉串</strong>格式</li>
<li>父组件的<strong>监听事件名</strong>和子组件的<strong>触发事件名</strong>必须一模一样</li>
<li>子组件触发事件的时候，传过来的参数，父组件可以用<code>$event</code>接收</li>
</ul>
<h2 id="v-model语法糖"><a href="#v-model语法糖" class="headerlink" title="v-model语法糖"></a>v-model语法糖</h2><p>v-model是属性value和事件input的语法糖。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90b0ff8e502a48ac8aaf41a3bc0f91b3~tplv-k3u1fbpfcp-zoom-1.image" alt="v-model1"></p>
<p>没有语法糖的时候，这样写</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e006eca8c4f34562b4a479809b6e0f0a~tplv-k3u1fbpfcp-zoom-1.image" alt="v-model1"></p>
<p>用v-model的话，父组件就可以少了监听事件，用起来更加方便</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/26b85b55cdb943f79be600358db4ae6e~tplv-k3u1fbpfcp-zoom-1.image" alt="v-model2"></p>
<p>v-model的语法糖有其局限性：</p>
<ul>
<li>适用于：<strong>触发事件返回的值 正是 属性要改的值</strong>，一般是单一属性。比如触发事件返回的值正好就是提title的新值</li>
<li>更多逻辑的话，就不适用了</li>
<li>更适用于：表单类的组件，因为属性和事件默认是<code>value</code>和<code>input</code></li>
</ul>
<p>当然特定情况下，可以修改v-model的默认属性，但可读性就不是很好。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name:<span class="string">'ListItem'</span>,</span><br><span class="line">  model:&#123;</span><br><span class="line">    prop:<span class="string">'title'</span>,</span><br><span class="line">    input:<span class="string">'changeTitle'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sync语法糖"><a href="#sync语法糖" class="headerlink" title=".sync语法糖"></a>.sync语法糖</h2><p>.sync这个语法糖，同样适用于<strong>触发事件返回的值 正是 属性要改的值</strong>，可读性要强一些，可以用于非表单类的组件。<br>.sync语法糖默认是 属性xxx和事件update:xxx</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0faf3609165244b5a9c2d84c358b17c9~tplv-k3u1fbpfcp-zoom-1.image" alt="v-model1"></p>
<p>没有语法糖的时候，这样写</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ce26d3f69e984354b13358629fe9f70f~tplv-k3u1fbpfcp-zoom-1.image" alt="sync1"></p>
<p>用.sync的话，父组件仍然可以少监听事件，用起来更加方便</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b17603324b84359a1cf6014fb0d4fe9~tplv-k3u1fbpfcp-zoom-1.image" alt="sync2"></p>
<p>sync的语法糖有其局限性：</p>
<ul>
<li>适用于：触发事件返回的值 正是 属性要改的值，一般是单一属性。比如触发事件返回的值正好就是提title的新值</li>
<li>更多逻辑的话，就不适用了</li>
<li>更适用于：非表单类的组件</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>props/$emit是父子组件最常用的通信方式，而v-model、.sync只是其语法糖</li>
<li>子组件只是单一的修改某个父组件值的话，表单类组件使用<code>v-model</code>语法糖</li>
<li>子组件只是单一的修改某个父组件值的话，非表单类组件使用<code>sync</code>语法糖</li>
<li>复杂逻辑还是老老实实<code>props/$emit</code></li>
</ul>
<p>其实语法糖只是在父组件用的时候更加方便，而子组件该咋样还是咋样。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="props-emit的代码"><a href="#props-emit的代码" class="headerlink" title="props/$emit的代码"></a>props/$emit的代码</h3><p>List.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;pug&quot;&gt;</span><br><span class="line">//- 父组件</span><br><span class="line">div</span><br><span class="line">  //- item就是传递给ListItem的数据，属性是info</span><br><span class="line">  //- clickLike，就是监听ListItem的clickLike事件</span><br><span class="line">  list-item(v-for=&quot;(item,index) in list&quot; :key=&quot;index&quot;</span><br><span class="line">  :info=&quot;item&quot;</span><br><span class="line">  v-on:clickLike=&quot;change(item,$event)&quot;)</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ListItem from &quot;@/components/ListItem&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;List&quot;,</span><br><span class="line">  components: &#123; ListItem &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      list: [</span><br><span class="line">        &#123; title: &quot;vue3来了&quot;, collects: 20 &#125;,</span><br><span class="line">        &#123; title: &quot;怜怜来了&quot;, collects: 2000 &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 当clickLike事件发生的时候，执行此方法</span><br><span class="line">    // 这里的event是ListItem传过来的值</span><br><span class="line">    change(item, event) &#123;</span><br><span class="line">      item.collects = event;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>DetailItem.vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;pug&quot;&gt;</span><br><span class="line">//- 子组件</span><br><span class="line">div</span><br><span class="line">  h2 &#123;&#123;info.title&#125;&#125;</span><br><span class="line">  span 喜欢数 &#123;&#123;info.collects&#125;&#125;</span><br><span class="line">  div</span><br><span class="line">    button(@click=&quot;addCollect&quot;) 喜欢</span><br><span class="line">  hr</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;ListItem&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    // 这里定义父组件传过来的属性</span><br><span class="line">    info: &#123; type: Object, default: () =&gt; (&#123;&#125;) &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addCollect() &#123;</span><br><span class="line">      // 触发此组件的clickLike时间，并且传一个值给父组件</span><br><span class="line">      this.$emit(&quot;clickLike&quot;, this.info.collects + 1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="v-model代码"><a href="#v-model代码" class="headerlink" title="v-model代码"></a>v-model代码</h3><p>没有简写时候的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;pug&quot;&gt;</span><br><span class="line">//- 父组件</span><br><span class="line">div</span><br><span class="line">  list-item(:value=&quot;title&quot; v-on:input=&quot;change&quot;)</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ListItem from &quot;@/components/ListItem&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;List&quot;,</span><br><span class="line">  components: &#123; ListItem &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: &quot;怜怜来了&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 当clickLike事件发生的时候，执行此方法</span><br><span class="line">    // 这里的event是ListItem传过来的值</span><br><span class="line">    change(event) &#123;</span><br><span class="line">      this.title = event;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;pug&quot;&gt;</span><br><span class="line">//- 子组件</span><br><span class="line">div &#123;&#123;value&#125;&#125;</span><br><span class="line">  button(@click=&quot;changeTitle&quot;) 修改标题</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;ListItem&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: &#123; type: String, default: &quot;&quot; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    changeTitle() &#123;</span><br><span class="line">      this.$emit(&quot;input&quot;, &quot;换标题啦&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>简写时候的父组件代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;pug&quot;&gt;</span><br><span class="line">//- 父组件</span><br><span class="line">div</span><br><span class="line">  list-item(v-model=&quot;title&quot;)</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ListItem from &quot;@/components/ListItem&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;List&quot;,</span><br><span class="line">  components: &#123; ListItem &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: &quot;怜怜来了&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="sync的代码"><a href="#sync的代码" class="headerlink" title=".sync的代码"></a>.sync的代码</h3><p>没有简写的时候</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;pug&quot;&gt;</span><br><span class="line">//- 父组件</span><br><span class="line">div</span><br><span class="line">  list-item(:theme=&quot;title&quot; v-on:update:theme=&quot;change&quot;)</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ListItem from &quot;@/components/ListItem&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;List&quot;,</span><br><span class="line">  components: &#123; ListItem &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: &quot;怜怜来了&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 当clickLike事件发生的时候，执行此方法</span><br><span class="line">    // 这里的event是ListItem传过来的值</span><br><span class="line">    change(event) &#123;</span><br><span class="line">      this.title = event;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;pug&quot;&gt;</span><br><span class="line">//- 子组件</span><br><span class="line">div &#123;&#123;theme&#125;&#125;</span><br><span class="line">  button(@click=&quot;changeTitle&quot;) 修改标题</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;ListItem&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    theme: &#123; type: String, default: &quot;&quot; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    changeTitle() &#123;</span><br><span class="line">      this.$emit(&quot;update:theme&quot;, &quot;换标题啦&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>简写的时候，父组件的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template lang=&quot;pug&quot;&gt;</span><br><span class="line">//- 父组件</span><br><span class="line">div</span><br><span class="line">  //- list-item(:theme=&quot;title&quot; v-on:update:theme=&quot;change&quot;)</span><br><span class="line">  list-item(:theme.sync=&quot;title&quot;)</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import ListItem from &quot;@/components/ListItem&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;List&quot;,</span><br><span class="line">  components: &#123; ListItem &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: &quot;怜怜来了&quot;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  // methods: &#123;</span><br><span class="line">  //   // 当clickLike事件发生的时候，执行此方法</span><br><span class="line">  //   // 这里的event是ListItem传过来的值</span><br><span class="line">  //   change(event) &#123;</span><br><span class="line">  //     this.title = event;</span><br><span class="line">  //   &#125;</span><br><span class="line">  // &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/13/vue_animate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/11/13/vue_animate/" itemprop="url">
                  怎么解决vue使用animate.css失效的问题
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-13T14:17:30+08:00">
                2020-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/11/13/vue_animate/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/11/13/vue_animate/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>animate.css</code>使用4.0版本以上的，一定要加前缀<code>animate__</code>。  </p>
<p>！！！注意，是两个<code>_</code>！！！</p>
<p><a href="https://cn.vuejs.org/v2/guide/transitions.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%B8%A1%E7%9A%84%E7%B1%BB%E5%90%8D" target="_blank" rel="noopener">vue官方文档使用的是3.1版本</a>，所以示例代码没有前缀<code>animate__</code>。  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span></span></span><br><span class="line"><span class="tag">    <span class="attr">enter-active-class</span>=<span class="string">"animate__animated animate__tada"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">leave-active-class</span>=<span class="string">"animate__animated animate__bounceOutRight"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">"show"</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="使用animate-css"><a href="#使用animate-css" class="headerlink" title="使用animate.css"></a>使用animate.css</h2><p>直接用CDN的话：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>用npm的话：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install animate.css --save</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">yarn add animate.css</span><br></pre></td></tr></table></figure>
<p>全局引用的话：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> animated <span class="keyword">from</span> <span class="string">"animate.css"</span>;</span><br><span class="line">Vue.use(animated);</span><br></pre></td></tr></table></figure>
<p>局部网页使用的话：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"@/../node_modules/animate.css/animate.css"</span>;</span><br></pre></td></tr></table></figure>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><ul>
<li><a href="https://cn.vuejs.org/v2/guide/transitions.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%B8%A1%E7%9A%84%E7%B1%BB%E5%90%8D" target="_blank" rel="noopener">vue的官方文档</a></li>
<li><a href="https://animate.style/" target="_blank" rel="noopener">animate.css的官方文档</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/11/mini_program/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/11/11/mini_program/" itemprop="url">
                  小程序开发的一些技巧
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-11T18:03:01+08:00">
                2020-11-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/11/11/mini_program/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/11/11/mini_program/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>笔者刚接触小程序不久，简单总结下，不对的地方欢迎指正。</p>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/" target="_blank" rel="noopener">官网小程序开发文档</a>。</p>
<h2 id="快速新建页面"><a href="#快速新建页面" class="headerlink" title="快速新建页面"></a>快速新建页面</h2><p>直接在<code>app.json</code>那边配置页面路径，这样会自动生成，页面的文件夹及其四个文件。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"pages"</span>: [<span class="string">"pages/demo/demo"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果不配置<code>&quot;entryPagePath&quot;</code>，则 pages 里的第一个项就是首页。</p>
<p>注意！！！</p>
<p>只有在<code>app.json</code>里配置了才是页面。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5546f7e397b4b9d8028ff8c3b981ce3~tplv-k3u1fbpfcp-zoom-1.image" alt="页面的四个文件"></p>
<h2 id="设置页面的背景色"><a href="#设置页面的背景色" class="headerlink" title="设置页面的背景色"></a>设置页面的背景色</h2><p>小程序里，每个页面有个隐藏的根元素<code>page</code>。<br>其最低高度就是整个屏幕的高度，当内容低于一屏时，想要设置整个页面背景色，可以巧妙的利用<code>page</code>元素</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">page</span>&#123;</span><br><span class="line">	<span class="attribute">backgroud-color</span>:<span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8791224692dd4d0f9e137ca176f75245~tplv-k3u1fbpfcp-zoom-1.image" alt="page元素"></p>
<h2 id="快速查看当前页面的所有绑定数据"><a href="#快速查看当前页面的所有绑定数据" class="headerlink" title="快速查看当前页面的所有绑定数据"></a>快速查看当前页面的所有绑定数据</h2><p>调试面板里有个<code>appData</code>,能迅速看到当前时间，data 里所有的值。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9dd77857571c45ea92589c5df7b14d2f~tplv-k3u1fbpfcp-zoom-1.image" alt="调试面板里有个`appData`"></p>
<h2 id="让事件不冒泡"><a href="#让事件不冒泡" class="headerlink" title="让事件不冒泡"></a>让事件不冒泡</h2><p>点击列表项跳到详情页，但点击头像是进入个人中心，而不想冒泡触发列表项的点击事件。<br>这时候可以巧妙的用下<code>catch</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">bind:tap</span>=<span class="string">"tapItem"</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">catch:tap</span>=<span class="string">"tapAvatar"</span> <span class="attr">class</span>=<span class="string">"avatar"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="事件想获取元素的其他数据-自定义属性"><a href="#事件想获取元素的其他数据-自定义属性" class="headerlink" title="事件想获取元素的其他数据 - 自定义属性"></a>事件想获取元素的其他数据 - 自定义属性</h2><p><code>vue</code>事件可以传入自定义数据，但是小程序不行，需要先加个自定义属性。</p>
<p>比如点击列表项跳到详情页需要<code>postId</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;view class="item" bind:tap="goDetail" data-post-id="&#123;&#123;item.postId&#125;&#125;"&gt;</span></span><br><span class="line">goDetail(e)&#123;</span><br><span class="line">  <span class="comment">// 这里请用currentTarget，表示当前绑定事件的元素</span></span><br><span class="line">  <span class="keyword">const</span> &#123;postId&#125; = e.currentTarget.dataset</span><br><span class="line">  wx.navigateTo(&#123;</span><br><span class="line">    url: <span class="string">`/pages/detail/detail?postId=<span class="subst">$&#123;postId&#125;</span>`</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// detail.js</span></span><br><span class="line">onLoad(options) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;postId&#125; = options</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意！！！<br>两个单词只能用<code>-</code>连接，而且不能使用驼峰，如果用<code>data-postId</code>的话，获取的时候只能<code>postid</code></p>
<h2 id="输入框-input-可以使用-confirm-事件"><a href="#输入框-input-可以使用-confirm-事件" class="headerlink" title="输入框 input 可以使用 confirm 事件"></a>输入框 input 可以使用 confirm 事件</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/component/input.html" target="_blank" rel="noopener">官方文档 input</a></p>
<p>输入在手机端会调起键盘，而键盘上会有<strong>完成键</strong>，小程序可以捕获<strong>点击完成键</strong>。</p>
<p>比如：当用户点击完成的时候，搜索</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;input bind:confirm="onSearch" type="search" &gt;&lt;/input&gt;</span></span><br><span class="line">  onSearch(e)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.detail)</span><br><span class="line">    <span class="comment">// value就是用户输入的值</span></span><br><span class="line">    <span class="keyword">const</span> &#123;value&#125; = e.detail</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>注意！！！<br>本地开发的时候，在小程序开发者工具里，可以点击<strong>回车键</strong>模拟。</p>
<h2 id="设置全局变量"><a href="#设置全局变量" class="headerlink" title="设置全局变量"></a>设置全局变量</h2><p>全局变量写在<code>app.js</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line">App(&#123;</span><br><span class="line">  onLaunch() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"app onload"</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  test: <span class="number">1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在其他地方获取：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里的app就是App里的对象参数，里面的所有函数和变量都可以拿到，getApp是小程序的方法</span></span><br><span class="line"><span class="keyword">const</span> app = getApp();</span><br><span class="line"><span class="keyword">const</span> &#123; test &#125; = getApp();</span><br></pre></td></tr></table></figure>
<p>设置全局效果，需要使用全局文件，<strong>其在所有页面生效</strong>：</p>
<ul>
<li>app.js</li>
<li>app.json</li>
<li>app.wxss</li>
</ul>
<h2 id="设置页面内部的变量"><a href="#设置页面内部的变量" class="headerlink" title="设置页面内部的变量"></a>设置页面内部的变量</h2><p>页面内部可能也需要共享一些变量，但不用显示在页面上</p>
<p>这些变量约定俗成的在前面加个<code>_</code>，增强可读性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data:&#123;</span><br><span class="line">  _pid:<span class="literal">null</span></span><br><span class="line">&#125;,</span><br><span class="line">onLoad(options)&#123;</span><br><span class="line">  <span class="keyword">this</span>.data._pid = options._pid</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="路由跳转区分-navigateTo-和-redirectTo"><a href="#路由跳转区分-navigateTo-和-redirectTo" class="headerlink" title="路由跳转区分 navigateTo 和 redirectTo"></a>路由跳转区分 navigateTo 和 redirectTo</h2><ul>
<li><code>navigateTo</code>：保留旧页面，再跳转到新页面，触发<code>onHide</code>。更多表现父子关系，可以返回父页面。</li>
<li><code>redirectTo</code>：销毁旧页面，直接打开新页面，触发<code>onUnload</code>，如果页面栈是空的话，会显示<strong>首页</strong>图标。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wx.navigateTo(&#123; <span class="attr">url</span>: <span class="string">"/pages/detail/detail"</span> &#125;);</span><br><span class="line">wx.redirectTo(&#123; <span class="attr">url</span>: <span class="string">"/pages/welcome/welcome"</span> &#125;);</span><br></pre></td></tr></table></figure>
<p>注意！！！<br>小程序目前最多支持 <strong>10</strong> 层子页面。</p>
<h2 id="让-swiper-滑块容器固定宽高"><a href="#让-swiper-滑块容器固定宽高" class="headerlink" title="让 swiper 滑块容器固定宽高"></a>让 swiper 滑块容器固定宽高</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html" target="_blank" rel="noopener">官方文档</a></p>
<p>单纯的让设置<code>swiper</code>宽高，有时不一定有理想效果。</p>
<p>此时，可以设置<code>swiper-item</code>里面的元素的宽高。</p>
<h2 id="设置水平滚动的效果"><a href="#设置水平滚动的效果" class="headerlink" title="设置水平滚动的效果"></a>设置水平滚动的效果</h2><p>水平滚动是不太能用 web 端的那种，需要使用<code>scroll-view</code></p>
<p>注意！！！</p>
<p>如果用了 <code>flex 布局</code>的话，记得启用<code>enable-flex</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">enable-flex</span> <span class="attr">scroll-x</span>&gt;</span><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="直接显示正在开发的页面-增加编译模式"><a href="#直接显示正在开发的页面-增加编译模式" class="headerlink" title="直接显示正在开发的页面 - 增加编译模式"></a>直接显示正在开发的页面 - 增加编译模式</h2><p>正在开发的页面，不希望总是从首页一点点进去，而是希望页面能直接显示</p>
<ul>
<li>显示正在开发中的页面</li>
<li>点击编辑区上方的<strong>普通编译</strong></li>
<li>添加编译模式</li>
<li><strong>自动填充</strong>当前页面的路径，额外需要参数的话自己添加</li>
</ul>
<h2 id="配置导航栏标题"><a href="#配置导航栏标题" class="headerlink" title="配置导航栏标题"></a>配置导航栏标题</h2><p>静态显示，配置页面的<code>json</code>文件，<code>&quot;navigationBarTitleText&quot;: &quot;更多&quot;</code>。</p>
<p>动态显示，<code>js</code>文件里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">onReady()&#123;</span><br><span class="line">  wx.setNavigationBarTitle(&#123; <span class="attr">title</span>: <span class="string">'title'</span>, &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>顺便提下，配置颜色的话使用<code>navigationBarBackgroundColor</code></p>
<h2 id="在导航栏显示加载图标"><a href="#在导航栏显示加载图标" class="headerlink" title="在导航栏显示加载图标"></a>在导航栏显示加载图标</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 显示</span></span><br><span class="line">wx.showNavigationBarLoading()</span><br><span class="line"><span class="comment">// 发请求</span></span><br><span class="line"><span class="keyword">await</span> wx.request(...)</span><br><span class="line"><span class="comment">// 隐藏</span></span><br><span class="line">wx.hideNavigationBarLoading()</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/74675daefbe94eb3a935c3f9660d78da~tplv-k3u1fbpfcp-zoom-1.image" alt="mini_loading"></p>
<h2 id="上滑触底加载更多数据"><a href="#上滑触底加载更多数据" class="headerlink" title="上滑触底加载更多数据"></a>上滑触底加载更多数据</h2><p>小程序提供<code>onReachBottom</code>，每次滑动到底部的时候，会自动触发该事件。</p>
<p>在该事件里，请求下一页的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onReachBottom() &#123;</span><br><span class="line">    <span class="comment">// 如果已经加载完就不用再加载了</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.data._isLoadAll)&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'到底啦'</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 请求下一页数据</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> wx.request(&#123;</span><br><span class="line">      url: <span class="string">'/list'</span>,</span><br><span class="line">      data:&#123;</span><br><span class="line">        start:<span class="keyword">this</span>.data.movies.length,</span><br><span class="line">        count:<span class="number">12</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> list = res.data.subjects</span><br><span class="line">    <span class="comment">// 判断是不是加载完了</span></span><br><span class="line">    <span class="keyword">this</span>.data._isLoadAll = list.length &lt; <span class="number">12</span></span><br><span class="line">    <span class="comment">// 追加数据</span></span><br><span class="line">    list = [...this.data.movies,...list]</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      movies:list</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h2 id="下拉刷新数据"><a href="#下拉刷新数据" class="headerlink" title="下拉刷新数据"></a>下拉刷新数据</h2><p>首先在<code>json</code> 文件，配置<code>&quot;enablePullDownRefresh&quot;: true</code></p>
<p>配置完，下拉相应的页面，就会出现三个点的加载效果。</p>
<p>当用户下拉的时候，会触发事件<code>onPullDownRefresh</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onPullDownRefresh() &#123;</span><br><span class="line">  <span class="keyword">const</span> res = wx.request(&#123;</span><br><span class="line">    url:<span class="string">'/list'</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      start: <span class="number">0</span>,</span><br><span class="line">      count: <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 记得关闭三个点的回弹的效果，默认的回弹效果时间约3s</span></span><br><span class="line">  wx.stopPullDownRefresh()</span><br><span class="line">  <span class="keyword">this</span>.setData(&#123; <span class="attr">movies</span>: res.data.subjects &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h2 id="增删改查缓存"><a href="#增删改查缓存" class="headerlink" title="增删改查缓存"></a>增删改查缓存</h2><p>小程序的缓存可以存储任意类型的值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增改</span></span><br><span class="line">wx.setStorageSync(<span class="string">"test"</span>, <span class="number">888</span>);</span><br><span class="line"><span class="comment">// 删除某个key</span></span><br><span class="line">wx.removeStorageSync(<span class="string">"test"</span>);</span><br><span class="line"><span class="comment">// 清空缓存</span></span><br><span class="line">wx.clearStorageSync();</span><br><span class="line"><span class="comment">// 查</span></span><br><span class="line"><span class="keyword">const</span> test = wx.getStorageSync(<span class="string">"test"</span>);</span><br></pre></td></tr></table></figure>
<p>一般存储的逻辑是:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先从缓存拿数据</span></span><br><span class="line"><span class="keyword">let</span> info = wx.getStorageSync(<span class="string">"info"</span>);</span><br><span class="line"><span class="comment">// 根据交互修改数据</span></span><br><span class="line">info.name = <span class="string">"yan"</span>;</span><br><span class="line"><span class="comment">// 修改完之后，记得同步下缓存里数据</span></span><br><span class="line">wx.setStorageSync(<span class="string">"info"</span>, info);</span><br><span class="line"><span class="comment">// 如果需要在view显示，需要更新下data</span></span><br><span class="line"><span class="keyword">this</span>.setData(&#123; <span class="attr">name</span>: info.name &#125;);</span><br></pre></td></tr></table></figure>
<p><a href="https://www.zhangxinxu.com/wordpress/2019/08/css-flex-last-align/" target="_blank" rel="noopener">更多法子</a></p>
<h2 id="下载最新的稳定版小程序开发工具"><a href="#下载最新的稳定版小程序开发工具" class="headerlink" title="下载最新的稳定版小程序开发工具"></a>下载最新的稳定版小程序开发工具</h2><p>工欲善其事必先利其器，选择最新的稳定版，<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener">下载页面</a></p>
<h2 id="注册-appId-和获取-appId"><a href="#注册-appId-和获取-appId" class="headerlink" title="注册 appId 和获取 appId"></a>注册 appId 和获取 appId</h2><ul>
<li><a href="https://mp.weixin.qq.com/wxopen/waregister?action=step1" target="_blank" rel="noopener">这里注册 appId</a></li>
<li>appId 的获取：<a href="https://mp.weixin.qq.com/wxamp/index/index?lang=zh_CN" target="_blank" rel="noopener">微信公众平台</a> - 开发设置 - 获取</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28dc064578794c3896db1e8269cb7b08~tplv-k3u1fbpfcp-zoom-1.image" alt="mini_appid"></p>
<h2 id="小程序开发工具的常用设置"><a href="#小程序开发工具的常用设置" class="headerlink" title="小程序开发工具的常用设置"></a>小程序开发工具的常用设置</h2><ul>
<li>稍微隐蔽的：可以切换网络环境、模拟手机端的 Home 键、返回键</li>
<li>编辑器可设置深色皮肤 - 菜单栏的设置里</li>
<li><p>必须勾选的本地设置</p>
<ul>
<li>勾选增强编译 (支持 async 这类的)</li>
<li>勾选使用 npm 模块</li>
<li>勾选不校验合法域名 (上线的时候必须是 https，但是测试环境可以没有)</li>
</ul>
</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/163d6f98a6da43acad55daea0d05f417~tplv-k3u1fbpfcp-zoom-1.image" alt="小程序开发工具的常用设置"></p>
<h2 id="项目使用-npm"><a href="#项目使用-npm" class="headerlink" title="项目使用 npm"></a>项目使用 npm</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html" target="_blank" rel="noopener">官方文档</a>。</p>
<ul>
<li>先看下根目录有没有<code>package.json</code>，没有的话先执行<code>npm init -y</code>快速创建一个：</li>
<li>本地设置 - 勾选“使用 npm 模块”选项</li>
<li>点击菜单栏 =&gt; 工具 =&gt; 构建 npm。根目录里会自动生成<code>miniprogram_npm</code>文件夹，里面内容和 node_modules 是一样的。</li>
<li>使用第三方组件的话，和自定义组件一样需要配置字段<code>usingComponents</code></li>
</ul>
<p>注意：如果仅是开发情况下用的话，使用<code>npm i xxx -D</code>。这样，打包的时候就不会打包该插件了。</p>
<h2 id="快速查看某个标签的使用文档"><a href="#快速查看某个标签的使用文档" class="headerlink" title="快速查看某个标签的使用文档"></a>快速查看某个标签的使用文档</h2><p>将鼠标放在标签上，就会出现一个气泡，就有一个相应标签的文档链接。</p>
<h2 id="设置标签某属性值是-false-的话"><a href="#设置标签某属性值是-false-的话" class="headerlink" title="设置标签某属性值是 false 的话"></a>设置标签某属性值是 false 的话</h2><p>布尔类型的属性值:</p>
<ul>
<li><code>true</code>的话，直接写上改属性即可，<code>&lt;swiper autoplay&gt;</code></li>
<li><code>false</code>的话，需要加双大括号<code>&lt;swiper autoplay=&quot;false&quot;&gt;</code></li>
<li>其实，只要不是字符串或者数字类型的话，都需要加双大括号</li>
</ul>
<h2 id="设置选项卡-tabBar"><a href="#设置选项卡-tabBar" class="headerlink" title="设置选项卡 tabBar"></a>设置选项卡 tabBar</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#tabBar" target="_blank" rel="noopener">官方文档 tabBar</a></p>
<p><code>app.json</code>里添加<code>tabBar</code>，同时需要选中和未选中的图标，文字颜色也一样。<br>还可以配置<code>tabBar</code>的位置，在顶部或者底部，等等。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">"tabBar": &#123;</span><br><span class="line">  "selectedColor": "#333",</span><br><span class="line">  "color": "#999",</span><br><span class="line">  "list":[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"text"</span>:<span class="string">"阅读"</span>,</span><br><span class="line">      <span class="attr">"pagePath"</span>: <span class="string">"pages/list/list"</span>,</span><br><span class="line">      <span class="attr">"iconPath"</span>: <span class="string">"/images/1.png"</span>,</span><br><span class="line">      <span class="attr">"selectedIconPath"</span>: <span class="string">"/images/1.png"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"text"</span>:<span class="string">"电影"</span>,</span><br><span class="line">      <span class="attr">"pagePath"</span>: <span class="string">"pages/movies/movies"</span>,</span><br><span class="line">      <span class="attr">"iconPath"</span>: <span class="string">"/images/2.png"</span>,</span><br><span class="line">      <span class="attr">"selectedIconPath"</span>: <span class="string">"/images/2.png"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意！！！</p>
<p>如果页面变成 <code>tabBar</code> 的<code>pagePath</code>，跳转的话需要使用 <code>wx.switchTab({url:&#39;/pages/list/list&#39;})</code></p>
<h2 id="建议：推荐用-import-导入导出"><a href="#建议：推荐用-import-导入导出" class="headerlink" title="建议：推荐用 import - 导入导出"></a>建议：推荐用 import - 导入导出</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导出数据：</span></span><br><span class="line"><span class="keyword">var</span> posts = [&#123;<span class="attr">title</span>:<span class="string">"hello"</span>&#125;]</span><br><span class="line">exports &#123; <span class="attr">list</span>:posts &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入数据</span></span><br><span class="line"><span class="keyword">import</span> &#123; list &#125; <span class="keyword">from</span> <span class="string">"../data/data.js"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(list);</span><br></pre></td></tr></table></figure>
<p>不推荐 require：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> posts = [&#123; <span class="attr">title</span>: <span class="string">"hello"</span> &#125;];</span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">list</span>: posts &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入数据</span></span><br><span class="line"><span class="keyword">var</span> list = <span class="built_in">require</span>(<span class="string">"../data/data.js"</span>).list;</span><br></pre></td></tr></table></figure>
<h2 id="建议：引用图片尽量用绝对路径"><a href="#建议：引用图片尽量用绝对路径" class="headerlink" title="建议：引用图片尽量用绝对路径"></a>建议：引用图片尽量用绝对路径</h2><p>引用图片可以两种路径：</p>
<ul>
<li>绝对路径：<code>/images/avatar.png</code></li>
<li>相对路径：<code>./images/avatar.png</code></li>
</ul>
<p>但推荐使用：绝对路径，不容易出错，而且相对简短些。</p>
<h2 id="建议：尽量避免使用小程序的原生-button"><a href="#建议：尽量避免使用小程序的原生-button" class="headerlink" title="建议：尽量避免使用小程序的原生 button"></a>建议：尽量避免使用小程序的原生 button</h2><p>小程序的原生<code>button</code>不是很好使用，没有特殊情况，直接用<code>view</code>模拟就好。</p>
<h2 id="推荐：异步方案使用-await"><a href="#推荐：异步方案使用-await" class="headerlink" title="推荐：异步方案使用 await"></a>推荐：异步方案使用 await</h2><p>推荐<code>await</code>，注意必须在<code>async</code>函数内部使用:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> onLoad()&#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> wx.request(&#123;...&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="推荐：第三方组件库-LinUI"><a href="#推荐：第三方组件库-LinUI" class="headerlink" title="推荐：第三方组件库-LinUI"></a>推荐：第三方组件库-LinUI</h2><p><a href="https://github.com/TaleLin/lin-ui" target="_blank" rel="noopener">github 地址</a><br><a href="https://doc.mini.talelin.com/" target="_blank" rel="noopener">官方文档</a></p>
<p>LinUI 组件库可以作为小程序原始组件库的补充。</p>
<h2 id="注意：设置-wx-for-的-key-是不要双大括号的"><a href="#注意：设置-wx-for-的-key-是不要双大括号的" class="headerlink" title="注意：设置 wx:for 的 key 是不要双大括号的"></a>注意：设置 wx:for 的 key 是不要双大括号的</h2><p>同理，<code>item</code>和<code>index</code>也不需要双大括号</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">block</span></span></span><br><span class="line"><span class="tag">  <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;posts&#125;&#125;"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">wx:key</span>=<span class="string">"postId"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">wx:for-item</span>=<span class="string">"item"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">wx:for-index</span>=<span class="string">"index"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">block</span>&gt;</span><span class="tag">&lt;/<span class="name">block</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="注意：image-不支持长按识别"><a href="#注意：image-不支持长按识别" class="headerlink" title="注意：image 不支持长按识别"></a>注意：image 不支持长按识别</h2><ul>
<li>image 组件默认宽度 320px、高度 240px</li>
<li>image 组件中二维码/小程序码图片不支持长按识别。仅在<a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.previewImage.html" target="_blank" rel="noopener"><code>wx.previewImage</code></a>中支持长按识别</li>
</ul>
<h2 id="编写自定义组件"><a href="#编写自定义组件" class="headerlink" title="编写自定义组件"></a>编写自定义组件</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/" target="_blank" rel="noopener">官方文档</a></p>
<p>自定义组件一般在文件夹<code>components</code>那边，结构和页面根相似，一个组件包含一个文件夹和四个文件。</p>
<p>用自定义组件的话，记得在<code>json</code> 里配置<code>usingComponents:{&quot;post&quot;:&quot;/components/post/index&quot;}</code></p>
<p>这里再次强调，自定义组件的名字是使用页面决定的，并不是文件的名字决定的。</p>
<h3 id="组件添加属性"><a href="#组件添加属性" class="headerlink" title="组件添加属性"></a>组件添加属性</h3><p>注意，设置类型就会有当前类型的默认值，Number 的默认值是 0 等等</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件内部js</span></span><br><span class="line">properties: &#123;</span><br><span class="line">  text:&#123;</span><br><span class="line">    type:<span class="built_in">String</span>,</span><br><span class="line">    <span class="comment">// value就是默认值</span></span><br><span class="line">    value:<span class="string">'123'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  text2:<span class="built_in">String</span></span><br><span class="line">&#125;,</span><br><span class="line">onLoad()&#123;</span><br><span class="line">  <span class="comment">// 获取自定义属性</span></span><br><span class="line">  <span class="keyword">const</span> text = <span class="keyword">this</span>.properties.text</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用的话</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">post</span> <span class="attr">text</span>=<span class="string">"77"</span>&gt;</span><span class="tag">&lt;/<span class="name">post</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>添加事件的话放在 methods，类似 vue。</p>
<h3 id="组件添加自定义事件和传参"><a href="#组件添加自定义事件和传参" class="headerlink" title="组件添加自定义事件和传参"></a>组件添加自定义事件和传参</h3><p>组件内部</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;view bind:tap="onTap"&gt;</span></span><br><span class="line">methods:&#123;</span><br><span class="line">  onTap(event)&#123;</span><br><span class="line">    <span class="keyword">this</span>.triggerEvent(<span class="string">"tapPost"</span>,&#123;event,<span class="attr">uid</span>:<span class="string">"uid"</span>&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用的话</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;movie bind:tapPost="onGoPageDetail"&gt;&lt;/movie&gt;</span></span><br><span class="line">onGoPageDetail(e)&#123;</span><br><span class="line">  <span class="comment">// e.detail就是triggerEvent的第二个参数，即&#123;event,uid:"uid"&#125;</span></span><br><span class="line">  <span class="keyword">const</span> &#123;event,uid&#125; = e.detail</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="给组件容器加样式-外部样式类"><a href="#给组件容器加样式-外部样式类" class="headerlink" title="给组件容器加样式 - 外部样式类"></a>给组件容器加样式 - 外部样式类</h3><p>如果组件写好之后，使用组件的时候，需要给组件在使用场景里增加一些样式，单纯的增加类名，可能 不会生效，这时候需要添加外部样式类。</p>
<ul>
<li>在组件的<code>wxml</code>的最外层容器 加上 <code>&lt;view class=&quot;f-class&quot;&gt;</code></li>
<li>在组件的 <code>js</code> 上增加<code>externalClasses:[&#39;f-class&#39;]</code></li>
<li>在使用组件的时候，<code>&lt;movie-list f-class=&quot;movie-list&quot;&gt;</code></li>
<li>写样式的时候，<code>.movie-list{margin-bottom: 10rpx;}</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  externalClasses: [<span class="string">"f-class"</span>],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>样式名，一般都以 class 结尾，可读性强。</p>
<p>外部样式类如果不生效，可能是和组件内部的样式冲突了，增加外部样式类的权重即可，比如<code>!important</code></p>
<p>注意！！！</p>
<p>上面说了可能不会生效，但是有一种情况是不需要外部类，也能生效的。</p>
<p>当组件是<code>flex项</code>的时候，设置的 <code>class</code> 可生效。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">"display:flex"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">movie</span> <span class="attr">class</span>=<span class="string">"movie"</span>&gt;</span><span class="tag">&lt;/<span class="name">movie</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- wxss --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- .movie&#123;margin-left:10rpx&#125; --&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><ul>
<li><a href="https://coding.imooc.com/learn/list/75.html" target="_blank" rel="noopener">7月的小程序视频</a></li>
</ul>
<!--
## 弹出框 - 交互反馈

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 轻提示 不用用户操作 显示几秒后自动消失</span></span><br><span class="line">wx.showToast(&#123;</span><br><span class="line">  title: <span class="string">"收藏成功"</span>,</span><br><span class="line">  duration: <span class="number">3000</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 强提示 必须用户操作 弹框才会消失</span></span><br><span class="line"><span class="comment">// 这个方法也是异步的，同样可以await</span></span><br><span class="line"><span class="comment">// 这里可以用await简单获得用户点击的是不是确定键</span></span><br><span class="line"><span class="keyword">const</span> isConfirm = (</span><br><span class="line">  <span class="keyword">await</span> wx.showModal(&#123;</span><br><span class="line">    title: <span class="string">"确定操作么"</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">).confirm;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作菜单，下方滑出，最后一个是取消</span></span><br><span class="line"><span class="keyword">const</span> itemList = [<span class="string">"分享到朋友圈"</span>, <span class="string">"分享到微信 "</span>];</span><br><span class="line"><span class="comment">// 用户点了tab的相应index</span></span><br><span class="line"><span class="keyword">const</span> tabIndex = (<span class="keyword">await</span> wx.showActionSheet(&#123; itemList &#125;)).tabIndex;</span><br></pre></td></tr></table></figure>
<h2 id="语音播放"><a href="#语音播放" class="headerlink" title="语音播放"></a>语音播放</h2><h3 id="播放背景音乐"><a href="#播放背景音乐" class="headerlink" title="播放背景音乐"></a>播放背景音乐</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.getBackgroundAudioManager.html">官方文档</a></p>
<p>背景音乐一旦开启，在不关闭的情况下，理论上在任意页面都会播放。</p>
<p>而且微信会自动添加一个播放组件在页面底部。超级爽~</p>
<p>所以背景音乐的播放或者暂停，可以放在全局变量。</p>
<p>但是单个页面的时候，初始状态需要获取全局的变量，而且在单个页面的音乐状态变化会影响到全局。</p>
<p>比如全局变量<code>gIsPlayingMusic</code>还要一个全局变量<code>gSongId</code>.</p>
<p>全局记录播放状态，和播放的什么歌。</p>
<p>pause 是暂停，还可以继续播放<br>stop 是停止，不可以继续播放，会从头播放</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">onLoad()&#123;</span><br><span class="line">  <span class="comment">// 一般在onload的时候就初始化一个对象，这个对象也定义在data里</span></span><br><span class="line">  <span class="keyword">this</span>.data._musicBgManager = wx.getBackgroundAudioManager()</span><br><span class="line">   <span class="comment">// 播放的时候一般相应的改变状态，全局和本页面都需要修改</span></span><br><span class="line">  musicBgManager.onPlay(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    app.gIsPlayingMusic = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>.onMusicStart()</span><br><span class="line">  &#125;)</span><br><span class="line">  musicBgManager.onPause(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    app.gIsPlayingMusic = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.onMusicStop()</span><br><span class="line">  &#125;)</span><br><span class="line">  musicBgManager.onStop(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    app.gIsPlayingMusic = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.onMusicStop()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 特定页面内 进入的时候，先获取全局的</span></span><br><span class="line">  <span class="keyword">this</span>.currentMusicIsPlaying()</span><br><span class="line"></span><br><span class="line">&#125;,</span><br><span class="line">currentMusicIsPlaying()&#123;</span><br><span class="line">  <span class="keyword">const</span> isPlaying = app.gIsPlayingMusic &amp;&amp; app.gSongId === <span class="keyword">this</span>.data.songId</span><br><span class="line">  <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">    isPlaying</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">onMusicStart()&#123;</span><br><span class="line">  <span class="keyword">const</span> musicBgManager = <span class="keyword">this</span>.data._musicBgManager</span><br><span class="line">  <span class="keyword">const</span> url = <span class="string">"https://wechatapppro-1252524126.file.myqcloud.com/appbbQAqCji4983/audio/kfyf5ofe0hboh7cbrpg6.mp3"</span></span><br><span class="line">  musicBgManager.src = url</span><br><span class="line">  musicBgManager.title = <span class="string">"有血有肉"</span></span><br><span class="line">  musicBgManager.play()</span><br><span class="line">&#125;</span><br><span class="line">onMusicStop()&#123;</span><br><span class="line">  <span class="keyword">const</span> musicBgManager = <span class="keyword">this</span>.data._musicBgManager</span><br><span class="line">  musicBgManager.stop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果希望切到后台依然播放的话，需要<code>app.json</code>那么添加<code>&quot;requiredBackgroundModes&quot;: [&quot;audio&quot;,&quot;location&quot;]</code></p>
<p>音频播放的时候，有相应的钩子，可以触发想要的操作，<code>onPlay(fn)</code><br>音频暂停的时候，有相应的钩子，可以触发想要的操作，<code>onPause(fn)</code><br>音频停止的时候，有相应的钩子，可以触发想要的操作，<code>onStop(fn)</code></p>
<h2 id="生命周期函数和特殊回调函数"><a href="#生命周期函数和特殊回调函数" class="headerlink" title="生命周期函数和特殊回调函数"></a>生命周期函数和特殊回调函数</h2><p>小程序系统内部自动调用生命周期函数。</p>
<p>onLoad: 页面加载，初始化代码，初始化请求<br>onShow：页面显示但是数据并没有完毕<br>onReady：页面数据完毕，已经加载完<br>onHide：切后台<br>onUnload：某种路由跳转的时候触发</p>
<p>onPullDownRefresh：下拉的时候触发<br>onReachBottom：上拉的时候触发<br>onShareAppMessage：点击右上角三个点选择转发的时候触发</p>
<p>页面跳转的时候会不同情境触发 onHide onUnload –&gt;</p>
-->
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/04/vue-click-outside/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/11/04/vue-click-outside/" itemprop="url">
                  怎么点击下拉框外面关闭下拉框
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-04T18:04:36+08:00">
                2020-11-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/11/04/vue-click-outside/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/11/04/vue-click-outside/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前看到<a href="https://juejin.im/post/6890135726647296014" target="_blank" rel="noopener">我不能没有的 5 个 Vue.js 库</a>，里面第一个就是<code>Click Off to Close</code>，最主要功能就是，在用户点击元素之外的时候触发一个事件。</p>
<p>此文的目标，手写自定义指令实现此功能。</p>
<p>功能比如自己封装一个下拉框，或者封装一个日历，希望在点击非下拉框部分，能关闭下拉框。</p>
<p><img src="https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/select-box2.gif" alt="下拉框"></p>
<h2 id="普通的下拉框"><a href="#普通的下拉框" class="headerlink" title="普通的下拉框"></a>普通的下拉框</h2><p>先实现一个普通的下拉框。<br>就是，一个框 + 一个面板。<br>点击框，显示或隐藏面板。</p>
<p><img src="https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/select-box.gif" alt="下拉框"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"select-box"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"trigger-head"</span> @<span class="attr">click</span>=<span class="string">"clickSelect"</span>&gt;</span>点击下拉<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"isShow"</span> <span class="attr">class</span>=<span class="string">"trigger-body"</span>&gt;</span>我是下拉框<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/vue"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  const vm = new Vue(&#123;</span></span><br><span class="line"><span class="undefined">    el: "#app",</span></span><br><span class="line"><span class="undefined">    data: &#123;</span></span><br><span class="line"><span class="undefined">      isShow: false</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    methods: &#123;</span></span><br><span class="line"><span class="undefined">      clickSelect() &#123;</span></span><br><span class="line"><span class="undefined">        this.isShow = !this.isShow;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- style这里先放后面，毕竟不是说的重点 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  .select-box &#123;</span></span><br><span class="line"><span class="undefined">    width: 200px;</span></span><br><span class="line"><span class="undefined">    margin-left: 200px;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  .trigger-head &#123;</span></span><br><span class="line"><span class="undefined">    border: 1px solid #ccc;</span></span><br><span class="line"><span class="undefined">    padding: 10px;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">  .trigger-body &#123;</span></span><br><span class="line"><span class="undefined">    width: 200px;</span></span><br><span class="line"><span class="undefined">    height: 300px;</span></span><br><span class="line"><span class="undefined">    background-color: #ccc;</span></span><br><span class="line"><span class="undefined">    position: absolute;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="重点：点击外面就会关闭面板"><a href="#重点：点击外面就会关闭面板" class="headerlink" title="重点：点击外面就会关闭面板"></a>重点：点击外面就会关闭面板</h2><p>我先贴下代码，看完代码，基本就明白了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">  <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, (e)=&gt; &#123;</span><br><span class="line">    <span class="comment">// 记得在.select-box那边加上ref="selectBox"</span></span><br><span class="line">    <span class="keyword">const</span> selectBox = <span class="keyword">this</span>.$refs.selectBox;</span><br><span class="line">    <span class="comment">// 重点来了：selectBox里是否包含点击的元素，不包含点击的元素就隐藏面板</span></span><br><span class="line">    <span class="keyword">if</span> (!selectBox.contains(e.target)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.isShow = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>代码一看，其实看客们大约就明白了。</p>
<p>click 事件绑定在全局，然后通过<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/contains" target="_blank" rel="noopener"><code>contains</code></a>这个关键性的方法，判断点击的元素是不是<code>selectBox</code>的后代，要不是的话，就肯定点在了<code>selectBox</code>的外面，顺道就隐藏面板。至此，最关键性的逻辑就搞定了。</p>
<h2 id="封装成自定义指令"><a href="#封装成自定义指令" class="headerlink" title="封装成自定义指令"></a>封装成自定义指令</h2><p>最核心的逻辑就是上面了。<br>接下来就是封装成一个指令，专门处理这种，点击元素之外触发某种操作。</p>
<p><a href="https://cn.vuejs.org/v2/guide/custom-directive.html" target="_blank" rel="noopener">官方文档怎么封装自定义指令</a></p>
<p>这里封装一个，<code>clickOutside</code>的指令，绑定指令的元素，表示点击元素之外的地方就会执行相应的函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// html那边  &lt;div v-click-outside="hidePanel" ref="selectBox" class="select-box" &gt;</span></span><br><span class="line">Vue.directive(<span class="string">"click-outside"</span>, (el, bindings, vnode) =&gt; &#123;</span><br><span class="line">  <span class="comment">// el就是绑定指令的元素，bindings.expression就是动态参数这里是hide，vnode是绑定指令的元素的虚拟节点，vnode.context就是节点所在的vm实例</span></span><br><span class="line">  <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, e =&gt; &#123;</span><br><span class="line">    <span class="comment">// 点击的是 绑定指令元素么 不是就执行函数</span></span><br><span class="line">    <span class="keyword">if</span> (!el.contains(e.target)) &#123;</span><br><span class="line">      <span class="keyword">let</span> method = bindings.expression;</span><br><span class="line">      vnode.context[method]();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 顺便记得在methods里面添加 hidePanel()&#123; this.isShow = false &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义指令的钩子"><a href="#自定义指令的钩子" class="headerlink" title="自定义指令的钩子"></a>自定义指令的钩子</h2><p>上面基本差不多了，但是还有个优化的点，因为绑定事件是在<code>document</code>上，我们应该择时解绑。</p>
<p>在阅读完官网的文档之后，可以想到<code>unbind</code>这个钩子，一旦指令解绑，document 也就会自动解绑事件。</p>
<p>这里注意，为了方便解绑，所以需要将点击事件赋值给<code>el.handle</code>。</p>
<p>优化之后的指令代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">"click-outside"</span>, &#123;</span><br><span class="line">  <span class="comment">// el就是绑定指令的元素，bindings.expression就是动态参数这里是hide，vnode是绑定指令的元素的虚拟节点，vnode.context就是节点所在的vm实例</span></span><br><span class="line">  bind(el, bindings, vnode) &#123;</span><br><span class="line">    el.handle = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 点击的是 绑定指令元素么 不是就触发 参数传进来的函数</span></span><br><span class="line">      <span class="keyword">if</span> (!el.contains(e.target)) &#123;</span><br><span class="line">        <span class="keyword">let</span> method = bindings.expression;</span><br><span class="line">        vnode.context[method]();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">document</span>.addEventListener(<span class="string">"click"</span>, el.handle);</span><br><span class="line">  &#125;,</span><br><span class="line">  unbind(el) &#123;</span><br><span class="line">    <span class="comment">// 相关事件移除</span></span><br><span class="line">    <span class="built_in">document</span>.removeEventListener(<span class="string">"click"</span>, el.handle);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="附加：自动聚焦的指令"><a href="#附加：自动聚焦的指令" class="headerlink" title="附加：自动聚焦的指令"></a>附加：自动聚焦的指令</h2><p>不知道有没有发现，即便我们在<code>input</code>那边加上<code>autofocus</code>属性，但聚焦一瞬即过，然后就没有光标了。</p>
<p>因为<code>#app</code>里面的代码进入了一次fragment，编译好之后，然后再倒进去。所以初始有一瞬间的聚焦，再倒进去之后，聚焦效果就会失效。</p>
<p>于是呢，要是想要自动聚焦的效果，可以封装个简单的指令，这边直接用官网的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &lt;input type="text" v-focus&gt;</span></span><br><span class="line">Vue.directive(<span class="string">'focus'</span>, &#123;</span><br><span class="line">  <span class="comment">// 当被绑定的元素插入到 DOM 中时</span></span><br><span class="line">  inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 聚焦元素</span></span><br><span class="line">    el.focus()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/03/line-center/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/11/03/line-center/" itemprop="url">
                  试试用flex处理直线和其他元素居中
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-03T19:10:22+08:00">
                2020-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/css/" itemprop="url" rel="index">
                    <span itemprop="name">css</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/11/03/line-center/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/11/03/line-center/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>经常会碰到如图所示的效果<br><img src="https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/center-line.png" alt="线居中"></p>
<p>一般可能常用一个盒子里放线和文本，然后让文本或者线定位下。</p>
<p>这里考虑到更多的通用性，用下flex思维布局。</p>
<p>先实现两者没重叠的时候的样式</p>
<p><img src="https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/center-line2.png" alt="线居中"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"line-text-box"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"text"</span>&gt;</span>我是标题<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"line"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line-text-box</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.text</span>&#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.line</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那想要两者重叠，其实只要脱离文档流即可，另外考虑到两者垂直方向也是居中，所以额外还得加个属性。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.line-text-box</span>&#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.line</span>&#123;</span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种布局的方式是灵活，中间的文本可以换成多个图标，左对齐右对齐都很方便。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/19/el_template_render_mount/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/10/19/el_template_render_mount/" itemprop="url">
                  el、template、render、mount怎么用的
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-10-19T15:21:58+08:00">
                2020-10-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/10/19/el_template_render_mount/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/10/19/el_template_render_mount/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>el、template、render、mount四者混在一起的时候，有种乱乱的感觉，本文努力说清楚。</p>
<p>先说几个专业名词：</p>
<ul>
<li>编译：将模板字符串 生成 Dom。<code>&lt;div&gt;1&lt;/div&gt;</code>这样只是模板字符串，只有<code>createElement(&#39;div&#39;)</code>这才是Dom。</li>
<li>挂载元素：想象成一个占位，Vue 生成的 DOM 之后覆盖在这个元素上，注意，这个元素是会被干掉的，所以挂载元素不能是<code>html</code>或者<code>body</code></li>
</ul>
<p>开始可能<a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener">Vue官方教程更重要</a>，后期多看<a href="https://cn.vuejs.org/v2/api/#el" target="_blank" rel="noopener">Vue官方API文档</a>，这里有更多，你撸码时能用到的操作。以下，很多是文档里整理的。</p>
<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul>
<li>优先级：render &gt; template &gt; el 或 $mount</li>
<li>$mount的好处：可以先编译，然后想什么时候挂载就什么时候挂载</li>
</ul>
<h2 id="el"><a href="#el" class="headerlink" title="el"></a>el</h2><p>用法：<code>new Vue({el:&#39;#app&#39;})</code></p>
<ul>
<li><p>提供一个在页面上<strong>已存在的</strong> DOM 元素作为 Vue 实例的<strong>挂载</strong>元素，其会被 Vue 生成的 DOM <strong>替换</strong>。</p>
</li>
<li><p>在实例<strong>挂载之后</strong>，元素可以用 <code>vm.$el</code> 访问。</p>
</li>
<li><p>如果在实例化时存在这个选项，实例将<strong>立即进入</strong>编译过程，否则，需要显式调用 <code>vm.$mount()</code>，手动开启编译。</p>
</li>
<li><p>如果 <code>render</code> 函数和 <code>template</code> 属性都不存在，挂载 DOM 元素的 HTML 会被提取出来用作模板。</p>
</li>
</ul>
<h2 id="template"><a href="#template" class="headerlink" title="template"></a>template</h2><p>用法：<code>new Vue({template:&quot;&lt;div&gt;msg&lt;/div&gt;&quot;})</code></p>
<ul>
<li>一个字符串模板。模板将会替换挂载的元素。挂载元素的内容都将被忽略，除非模板的内容有分发插槽。</li>
<li>如果值以 # 开始，则它将被用作选择符，并使用匹配元素的 innerHTML 作为模板。常用的技巧是用 <code>&lt;script type=&quot;x-template&quot;&gt;</code>包含模板。</li>
<li>如果 <code>render</code> 函数存在，该模板将被忽略。</li>
</ul>
<!-- - 出于安全考虑，你应该只使用你信任的 Vue 模板。避免使用其他人生成的内容作为你的模板。 -->
<h2 id="render"><a href="#render" class="headerlink" title="render"></a>render</h2><p>用法：<code>new Vue({render(createElement){return createElement(&#39;div&#39;,&#39;hello&#39;) }})</code></p>
<ul>
<li><p>字符串模板的代替方案，允许你发挥 JavaScript 最大的编程能力。该渲染函数接收一个 createElement 方法作为第一个参数用来创建 VNode。</p>
</li>
<li><p>如果组件是一个函数组件，渲染函数还会接收一个额外的 context 参数，为没有实例的函数组件提供上下文信息。</p>
</li>
<li><p>render 函数若存在，将直接作为模板编译，而完全无视template或el挂载元素中提取出的 HTML 模板。</p>
</li>
</ul>
<h2 id="mount"><a href="#mount" class="headerlink" title="mount"></a>mount</h2><p>用法：</p>
<ul>
<li><code>new Vue({...}).$mount(&#39;#app&#39;)</code></li>
<li><p><code>var vm = new Vue({...}).$mount(); document.body.appendChild(vm.$el)</code></p>
</li>
<li><p>如果实例化时没有收到 el 选项，则它处于“未挂载”状态，没有关联的 DOM 元素。可以使用 <code>vm.$mount()</code> 手动地挂载一个未挂载的实例。</p>
</li>
<li><p>如果没有提供参数，模板将被渲染为文档之外的的元素，并且你必须使用<strong>原生 DOM API</strong>把它插入文档中。</p>
</li>
</ul>
<h2 id="大致图"><a href="#大致图" class="headerlink" title="大致图"></a>大致图</h2><p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d4df8e882664dc2bef75c7bfbcb1d0d~tplv-k3u1fbpfcp-zoom-1.image" alt="解析"></p>
<p>官网生命周期图:</p>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/099e7dad0318479585822db53ff0de50~tplv-k3u1fbpfcp-zoom-1.image" alt="官网周期"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/16/canvas_star/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/10/16/canvas_star/" itemprop="url">
                  canvas绘制五角星
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-10-16T10:48:52+08:00">
                2020-10-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/10/16/canvas_star/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/10/16/canvas_star/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>canvas 绘制多边形的通用步骤：</p>
<ol>
<li>找到每个点的坐标，形成路径</li>
<li>设置状态</li>
<li>绘制</li>
</ol>
<p>五角星的模样：</p>
<p><img src="https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/star.png" alt="五角星"></p>
<p>如果遇到正某形的情况，可以借助圆来计算。<br>这边，借助两个圆寻找每个点的坐标：</p>
<p><img src="https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/star_pos.png" alt="五角星1"></p>
<ul>
<li>五角星的外圈相邻点之间的角度是：360/5 = 72</li>
<li>同理，五角星的内圈相邻点之间的角度是：360/5 = 72</li>
<li>于是，五角星两个相邻点的之间的角度是：72/2 = 36</li>
<li>于是，五角星最右边的点和 x 轴之间的角度是：90-36-36 = 18</li>
<li>于是，直角三角形中斜边为 R，一个夹角是 18，则夹角的那边长度是<code>R*cos(18deg)</code>，非夹角的那边长度是<code>R*sin(18deg)</code></li>
<li>于是，外圈最右边的点坐标是<code>(R*cos(18deg),-R*sin(18deg))</code>，外圈往左的一个点是<code>(R*cos(18+72deg),-R*sin(18+72deg))</code>，以此类推</li>
<li>于是，内圈最右边的点坐标是<code>(r*cos(54deg),-r*sin(54deg))</code>，内圈往左的一个点是<code>(r*cos(54+72deg),-r*sin(54+72deg))</code>，以此类推</li>
</ul>
<p>这样可以写一个五角星的路径函数，这里注意 cos 函数需要另外封装下，这样更方便使用：</p>
<p><img src="https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/canvas_star_code.png" alt="绘制五角星"></p>
<p>五角星需要旋转角度的话，修改成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ..参数加个rotate即可</span></span><br><span class="line">ctx.lineTo(</span><br><span class="line">  R * cos(<span class="number">18</span> + i * angle - rotate) + x,</span><br><span class="line">  -R * sin(<span class="number">18</span> + i * angle - rotate) + y</span><br><span class="line">);</span><br><span class="line">ctx.lineTo(</span><br><span class="line">  r * cos(<span class="number">54</span> + i * angle - rotate) + x,</span><br><span class="line">  -r * sin(<span class="number">54</span> + i * angle - rotate) + y</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>修改 R 和 r 的值会有很多不同感觉的五角星，两者差距越大，五角星越尖锐，反之越圆润。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span> <span class="attr">width</span>=<span class="string">"500"</span> <span class="attr">height</span>=<span class="string">"500"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">"#canvas"</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="comment">// 角度转化成弧度</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> getRadianFromAngle = <span class="function">(<span class="params">angle</span>) =&gt;</span> (<span class="built_in">Math</span>.PI / <span class="number">180</span>) * angle;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 封装下cos  sin</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> cos = <span class="function">(<span class="params">angle</span>) =&gt;</span> <span class="built_in">Math</span>.cos(getRadianFromAngle(angle));</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> sin = <span class="function">(<span class="params">angle</span>) =&gt;</span> <span class="built_in">Math</span>.sin(getRadianFromAngle(angle));</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">getStarPath</span>(<span class="params">&#123; ctx, x, y, R, r, rotate = <span class="number">0</span> &#125;</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">    ctx.beginPath();</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> horn = <span class="number">5</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> angle = <span class="number">360</span> / horn;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; horn; i++) &#123;</span></span><br><span class="line"><span class="undefined">      ctx.lineTo( R * cos(18 + i * angle - rotate) + x, -R * sin(18 + i * angle - rotate) + y );</span></span><br><span class="line"><span class="undefined">      ctx.lineTo( r * cos(54 + i * angle - rotate) + x, -r * sin(54 + i * angle - rotate) + y );</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    ctx.closePath();</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 1.设置路径</span></span></span><br><span class="line"><span class="undefined">  getStarPath(&#123; ctx, x: 200, y: 200, R: 100, r: 50 &#125;);</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 2.设置状态</span></span></span><br><span class="line"><span class="javascript">  ctx.lineWidth = <span class="string">"3"</span>;</span></span><br><span class="line"><span class="javascript">  ctx.strokeStyle = <span class="string">"#f69"</span>;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 3.绘制</span></span></span><br><span class="line"><span class="undefined">  ctx.stroke();</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><blockquote>
<p><a href="https://www.imooc.com/video/3488" target="_blank" rel="noopener">liuyubobobo 的绘制五角星 视频</a><br><a href="https://www.imooc.com/learn/133" target="_blank" rel="noopener">liuyubobobo 的 Canvas 绘图与动画基础 视频</a><br><a href="https://www.imooc.com/learn/185" target="_blank" rel="noopener">liuyubobobo 的 Canvas 绘图详解 视频</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/10/canvas/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/10/10/canvas/" itemprop="url">
                  学习canvas
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-10-10T19:44:01+08:00">
                2020-10-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/10/10/canvas/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/10/10/canvas/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>canvas</code>是一个<code>HTML</code>标签，必须结合<code>JS</code>代码绘制和处理一些图形。</p>
<p>基本涉及到图片处理的相关操作，比如截图功能、合成图片、图片像素级处理、图片的动画，都可以考虑下<code>canvas</code>。</p>
<p>大名鼎鼎的<a href="https://echarts.apache.org/examples/zh/index.html" target="_blank" rel="noopener"><code>echarts</code></a>、<code>d3.js</code>、<code>three.js</code>可视化数据的这些库都是基于canvas。</p>
<p>哦，还能解决大量图片相关面试题，如实现动画时钟。</p>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd5262f51a074592a2d88fc8605a0d87~tplv-k3u1fbpfcp-zoom-1.image" alt="动画时钟"></p>
<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul>
<li>特基础知识：创建画布、获取渲染上下文、绘制矩形、绘制三角形、绘制圆弧、绘制文本</li>
<li>设置图形的各种样式，如背景、线、颜色和透明度</li>
<li>高阶知识：缓存路径、保存和恢复状态、移动坐标原点、旋转坐标轴、缩放网格、transform的使用</li>
<li>重点-操作图像：合成、裁剪、动画、控制每个像素、上传和下载</li>
</ul>
<h2 id="创造画布"><a href="#创造画布" class="headerlink" title="创造画布"></a>创造画布</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"tutorial"</span> <span class="attr">width</span>=<span class="string">"150"</span> <span class="attr">height</span>=<span class="string">"150"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上述代码，<code>canvas</code>就创造了一个 150*150 像素的画布了。</p>
<p><code>canvas</code>和<code>img</code>看起来很像，但其只有两个<strong>特有</strong>属性<code>width</code>和<code>height</code>，默认值是 300、150。<br>因为 canvas 是一个标签元素，自然可以使用属性设置，也可使用 css 设置样式。<br><strong>注意的是，如果 CSS 的尺寸与初始画布的比例不一致，它会出现扭曲，这时候就需要明确用属性标明宽高。</strong></p>
<h2 id="获取渲染上下文"><a href="#获取渲染上下文" class="headerlink" title="获取渲染上下文"></a>获取渲染上下文</h2><p>画布创建好，要想绘制图形，需要结合 JS。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>JS 先找到画布 canvas</li>
<li>然后用 canvas 的<code>getContext()</code>，来获得渲染上下文和它的绘画功能。其参数是上下文的格式，一般都是<code>2d</code></li>
</ul>
<p>这里说个基础点，canvas 画布，想象成格子本，每个格子是 1*1 像素，左上角的点是(0,0)，其他的点都有其相应的坐标(x,y)。</p>
<h2 id="绘制矩形"><a href="#绘制矩形" class="headerlink" title="绘制矩形"></a>绘制矩形</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这里style是为了显示画布大小，这样更好识别(x,y) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">"tutorial"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">width</span>=<span class="string">"150"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">height</span>=<span class="string">"150"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">style</span>=<span class="string">"border:1px solid #ccc;"</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span></span><br><span class="line"><span class="undefined">  ctx.fillRect(25, 25, 100, 100);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>fillRect(x, y, width, height)</code>，用颜色填充出一个矩形，x 和 y 是矩形左上角的坐标，width 和 height 是矩形宽高。</p>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/79162ae882a34f4b8ab5d337f4fde217~tplv-k3u1fbpfcp-zoom-1.image" alt="矩形"></p>
<p>当然绘制矩形，canvas 提供三种方法，上面是一个，下面两个类似（还有一个方法在后面）</p>
<ul>
<li><code>strokeRect(x, y, width, height)</code>，用线条绘制一个矩形轮廓</li>
<li><code>clearRect(x, y, width, height)</code>，像橡皮，清除指定矩形区域，让清除部分完全透明</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">ctx.fillRect(<span class="number">25</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">ctx.clearRect(<span class="number">45</span>, <span class="number">45</span>, <span class="number">60</span>, <span class="number">60</span>);</span><br><span class="line">ctx.strokeRect(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b02fb8eb187344928c96b54903d16079~tplv-k3u1fbpfcp-zoom-1.image" alt="矩形"></p>
<h2 id="绘制三角形"><a href="#绘制三角形" class="headerlink" title="绘制三角形"></a>绘制三角形</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.moveTo(<span class="number">75</span>, <span class="number">50</span>);</span><br><span class="line">ctx.lineTo(<span class="number">100</span>, <span class="number">75</span>);</span><br><span class="line">ctx.lineTo(<span class="number">100</span>, <span class="number">25</span>);</span><br><span class="line">ctx.closePath();</span><br><span class="line">ctx.stroke();</span><br><span class="line"><span class="comment">// ctx.fill();</span></span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99509e37ec3045ec86cd97185d140561~tplv-k3u1fbpfcp-zoom-1.image" alt="三角形"></p>
<p>canvas 绘制图形，只有两种方式，就是我们见到的两种：矩形和路径(由一系列点连成的线段)。所有其他类型的图形都是通过一条或者多条路径组合而成的。</p>
<p>使用路径绘制图形的步骤：</p>
<ul>
<li>准备绘制一个新的形状路径，<code>ctx.beginPath()</code></li>
<li>将笔触移动到指定位置，<code>ctx.moveTo(75, 50)</code></li>
<li>绘制从当前位置到指定位置的直线。<code>ctx.lineTo(100, 75)</code>;</li>
<li>绘制从当前位置到起始笔触的直线，形成封闭图形，路径结束，<code>ctx.closePath()</code></li>
<li>一旦路径生成，你就能通过描边或填充路径区域来渲染图形，<code>ctx.fill()</code>或<code>ctx.stroke()</code></li>
</ul>
<p>小提示，调用 fill()函数时，所有没有闭合的形状都会自动闭合，所以可省略 closePath()，但 stroke 不行哟。</p>
<p>想绘制两个三角形的话，重新启动<code>beginPath</code>开始画就可以了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...之前代码</span></span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.moveTo(<span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line">ctx.lineTo(<span class="number">150</span>, <span class="number">40</span>);</span><br><span class="line">ctx.lineTo(<span class="number">50</span>, <span class="number">150</span>);</span><br><span class="line">ctx.closePath();</span><br><span class="line">ctx.fill();</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53f8095cc5664fc4984c9d590ecdd739~tplv-k3u1fbpfcp-zoom-1.image" alt="三角形"></p>
<h2 id="绘制圆弧"><a href="#绘制圆弧" class="headerlink" title="绘制圆弧"></a>绘制圆弧</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 角度换算成弧度</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRadianFromAngle</span>(<span class="params">angle</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">Math</span>.PI / <span class="number">180</span>) * angle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">ctx.beginPath();</span><br><span class="line"><span class="comment">// 顺时针</span></span><br><span class="line">ctx.arc(<span class="number">75</span>, <span class="number">75</span>, <span class="number">32</span>, <span class="number">0</span>, getRadianFromAngle(<span class="number">90</span>), <span class="literal">false</span>);</span><br><span class="line">ctx.closePath();</span><br><span class="line">ctx.stroke();</span><br><span class="line"></span><br><span class="line">ctx.beginPath();</span><br><span class="line"><span class="comment">// 逆时针</span></span><br><span class="line">ctx.arc(<span class="number">75</span>, <span class="number">75</span>, <span class="number">32</span>, <span class="number">0</span>, getRadianFromAngle(<span class="number">135</span>), <span class="literal">true</span>);</span><br><span class="line">ctx.closePath();</span><br><span class="line">ctx.fill();</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a60e4bb6a1b4cd2887869a188429a78~tplv-k3u1fbpfcp-zoom-1.image" alt="弧形"></p>
<p><code>arc(x, y, radius, startRadian, endRadian, anticlockwise)</code>，画一个以<code>（x,y）</code>为圆心的以<code>radius</code>为半径的圆弧（圆），从<code>startRadian</code>开始到<code>endRadian</code>结束，按照<code>anticlockwise</code>给定的方向（anti 是反对的，clockwise 顺时针的，anticlockwise 逆时针，默认值是 false 也就是顺时针）来生成。</p>
<p>说人话：想象拿一个圆规，先确定圆心，圆规一个脚站好，在确定半径，圆规另一个脚拉开特定距离。0 度是圆心的右边，90 度是圆心的下边，180 度是圆心的左边，270 度是圆心的上边，360 度回归右边。画 0 到 90 度，顺时针的话是 1/4 圆，逆时针的话是 3/4 的圆，想象圆规开始画的情景。</p>
<p>注意这里的 arc 只是绘制路径，想要看到需要借助 fill 或者 stroke。</p>
<p>同理，这里说下矩形的另一个方法，<code>rect(x, y, width, height)</code>，相比<code>fillRect(x, y, width, height)</code>不一样的是，<code>fillRect</code>是自动填充出一个矩形，这里的<code>rect</code>只是绘制出路径，还需要用<code>fill</code>或<code>stroke</code>才能看到矩形。换言之，<code>fillRect = rect +fill</code>和<code>strokeRect = rect + stroke</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctx.rect(<span class="number">25</span>, <span class="number">25</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">ctx.fill();</span><br></pre></td></tr></table></figure>
<h2 id="绘制文本"><a href="#绘制文本" class="headerlink" title="绘制文本"></a>绘制文本</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line">ctx.font = <span class="string">"28px serif"</span>;</span><br><span class="line">ctx.fillText(<span class="string">"Hello world"</span>, <span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">ctx.font = <span class="string">"28px serif"</span>;</span><br><span class="line">ctx.strokeText(<span class="string">"Hello world"</span>, <span class="number">10</span>, <span class="number">80</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text = ctx.measureText(<span class="string">"foo"</span>);</span><br><span class="line"><span class="comment">// 37</span></span><br><span class="line"><span class="built_in">console</span>.log(text.width);</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9777986d70049c1b2d94f861e62c84c~tplv-k3u1fbpfcp-zoom-1.image" alt="字"></p>
<ul>
<li><code>fillText(text, x, y [, maxWidth])</code>在指定的(x,y)位置填充指定的文本，绘制的最大宽度是可选的.</li>
<li><code>strokeText(text, x, y [, maxWidth])</code>在指定的(x,y)位置绘制文本边框，绘制的最大宽度是可选的.</li>
<li><code>measureText()</code>返回一个 TextMetrics 对象的宽度所在像素，这些体现文本特性的属性。</li>
<li><code>font = value</code>，用来绘制文本的样式. 这个字符串使用和 CSS font 属性相同的语法. 默认的字体是 <code>10px sans-serif</code>。</li>
<li><code>textAlign = value</code>，文本对齐选项. 可选的值包括：start, end, left, right or center. 默认值是 start。</li>
<li><code>textBaseline = value</code>，基线对齐选项. 可选的值包括：top, hanging, middle, alphabetic, ideographic, bottom。默认值是 alphabetic。</li>
<li><code>direction = value</code>，文本方向。可能的值包括：ltr, rtl, inherit。默认值是 inherit。</li>
<li><code>shadowOffsetX = float</code> 设定阴影在 X 轴的延伸距离，它们是不受变换矩阵所影响的。负值表示阴影会往上或左延伸，正值则表示会往下或右延伸，默认为 0。</li>
<li><code>shadowOffsetY = float</code> 设定阴影在 Y 轴的延伸距离，它们是不受变换矩阵所影响的。负值表示阴影会往上或左延伸，正值则表示会往下或右延伸，默认为 0。</li>
<li><code>shadowBlur = float</code>用于设定阴影的模糊程度，其数值并不跟像素数量挂钩，也不受变换矩阵的影响，默认为 0。</li>
<li><code>shadowColor = color</code>用于设定阴影颜色效果，默认是全透明的黑色。</li>
</ul>
<h2 id="设置不同的颜色和透明度"><a href="#设置不同的颜色和透明度" class="headerlink" title="设置不同的颜色和透明度"></a>设置不同的颜色和透明度</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"><span class="comment">// 必须提前写好颜色</span></span><br><span class="line">ctx.fillStyle = <span class="string">"rgba(0,255,0,0.5)"</span>;</span><br><span class="line">ctx.rect(<span class="number">25</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">ctx.fill();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ！！！这里需要重置下路径哈，不然会和上面的混合在一起了</span></span><br><span class="line">ctx.beginPath();</span><br><span class="line">ctx.strokeStyle = <span class="string">"#FF0000"</span>;</span><br><span class="line">ctx.globalAlpha = <span class="number">0.5</span>;</span><br><span class="line">ctx.rect(<span class="number">80</span>, <span class="number">80</span>, <span class="number">40</span>, <span class="number">40</span>);</span><br><span class="line">ctx.stroke();</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd332799af824990b468c35506ec40db~tplv-k3u1fbpfcp-zoom-1.image" alt="色"></p>
<p>前期的 fill 和 stroke 都是黑色，需要别的颜色其实也很简单，想象你拿画笔，先选择特定颜色的画笔，然后画画就是特定颜色的了。这里的颜色同 css 的颜色，可以<code>#ff0000</code>、<code>red</code>、<code>rgba(255,0,0,0.5)</code>等。</p>
<ul>
<li>fillStyle = color</li>
<li>strokeStyle = color</li>
<li>透明度的话，一个是 rgba 模式，还有一个是<code>globalAlpha = 某数值</code></li>
</ul>
<h3 id="设置渐变色"><a href="#设置渐变色" class="headerlink" title="设置渐变色"></a>设置渐变色</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lineGrad = ctx.createLinearGradient(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>);</span><br><span class="line">lineGrad.addColorStop(<span class="number">0</span>, <span class="string">"#00ABEB"</span>);</span><br><span class="line">lineGrad.addColorStop(<span class="number">0.5</span>, <span class="string">"#fff"</span>);</span><br><span class="line">lineGrad.addColorStop(<span class="number">0.5</span>, <span class="string">"#26C000"</span>);</span><br><span class="line">lineGrad.addColorStop(<span class="number">1</span>, <span class="string">"#fff"</span>);</span><br><span class="line"></span><br><span class="line">ctx.strokeStyle = lineGrad;</span><br><span class="line">ctx.rect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">130</span>, <span class="number">130</span>);</span><br><span class="line">ctx.stroke();</span><br><span class="line"></span><br><span class="line">ctx.beginPath();</span><br><span class="line"><span class="comment">// 径向渐变</span></span><br><span class="line"><span class="keyword">var</span> radialGrad = ctx.createRadialGradient(<span class="number">45</span>, <span class="number">45</span>, <span class="number">10</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">30</span>);</span><br><span class="line">radialGrad.addColorStop(<span class="number">0</span>, <span class="string">"#A7D30C"</span>);</span><br><span class="line">radialGrad.addColorStop(<span class="number">0.9</span>, <span class="string">"#019F62"</span>);</span><br><span class="line">radialGrad.addColorStop(<span class="number">1</span>, <span class="string">"rgba(1,159,98,0)"</span>);</span><br><span class="line"></span><br><span class="line">ctx.fillStyle = radialGrad;</span><br><span class="line">ctx.rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line">ctx.fill();</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28446da5a6b84ed2b10d86a313ca76a1~tplv-k3u1fbpfcp-zoom-1.image" alt="渐变色"></p>
<ul>
<li><code>createLinearGradient(x1, y1, x2, y2)</code>，(x1,y1)渐变的起点与(x2,y2)终点</li>
<li><code>createRadialGradient(x1, y1, r1, x2, y2, r2)</code>，前三个定义一个以 (x1,y1) 为原点，半径为 r1 的圆，后三个参数则定义另一个以 (x2,y2) 为原点，半径为 r2 的圆</li>
<li><code>gradient.addColorStop(position, color)</code>，position 参数必须是一个 0.0 与 1.0 之间的数值，表示渐变中颜色所在的相对位置。例如，0.5 表示颜色会出现在正中间。color 参数必须是一个有效的 CSS 颜色值（如 #FFF， rgba(0,0,0,1)，等等）。</li>
</ul>
<h3 id="设置图案填充"><a href="#设置图案填充" class="headerlink" title="设置图案填充"></a>设置图案填充</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建新 image 对象，用作图案</span></span><br><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">img.src = <span class="string">"https://mdn.mozillademos.org/files/222/Canvas_createpattern.png"</span>;</span><br><span class="line">img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 创建图案</span></span><br><span class="line">  <span class="keyword">var</span> ptn = ctx.createPattern(img, <span class="string">"repeat"</span>);</span><br><span class="line">  ctx.fillStyle = ptn;</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ab70e739d9347bb89d9557c9edde1e6~tplv-k3u1fbpfcp-zoom-1.image" alt="图案"></p>
<p><code>createPattern(image, type)</code>，Image 可以是一个 Image 对象的引用，或者另一个 canvas 对象。Type 必须是下面的字符串值之一：<code>repeat，repeat-x，repeat-y 和 no-repeat</code>。</p>
<h2 id="设置线段的样式"><a href="#设置线段的样式" class="headerlink" title="设置线段的样式"></a>设置线段的样式</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line">ctx.lineWidth = <span class="number">10</span>;</span><br><span class="line">ctx.lineJoin = <span class="string">"round"</span>;</span><br><span class="line">ctx.setLineDash([<span class="number">40</span>, <span class="number">2</span>]);</span><br><span class="line">ctx.rect(<span class="number">20</span>, <span class="number">20</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">ctx.stroke();</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31824f810b1f4f95b904b3a1422dbb02~tplv-k3u1fbpfcp-zoom-1.image" alt="线段"></p>
<p>线段的样式有以下，需要的时候，细细研究下即可：</p>
<ul>
<li>lineWidth 线宽，是给定路径的中心到两边的粗细，注意最左边的以及所有宽度为奇数的线并不能精确呈现，这就是因为路径的定位问题。就是线宽的时候，需要考虑定位的问题。默认是 1。</li>
<li>lineCap 线端样式，butt，round 和 square。线端两端的帽子，butt 表示没帽子，round 是半圆帽子，square 是方块帽子。默认是 butt。</li>
<li>lineJoin 线端连接处样式，round, bevel 和 miter。连接处是怎么处理的，round 是边角被磨圆，bevel 是水平，miters 默认是 miter。</li>
<li>用 setLineDash 方法和 lineDashOffset 属性来制定虚线样式， setLineDash 方法接受一个数组，来指定线段与间隙的交替；lineDashOffset 属性设置起始偏移量。这个主要用在动画里。</li>
</ul>
<h2 id="缓存路径"><a href="#缓存路径" class="headerlink" title="缓存路径"></a>缓存路径</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"><span class="comment">// 先存矩形路径</span></span><br><span class="line"><span class="keyword">var</span> rectangle = <span class="keyword">new</span> Path2D();</span><br><span class="line">rectangle.rect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circle = <span class="keyword">new</span> Path2D();</span><br><span class="line">circle.moveTo(<span class="number">125</span>, <span class="number">35</span>);</span><br><span class="line">circle.arc(<span class="number">100</span>, <span class="number">35</span>, <span class="number">25</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI);</span><br><span class="line"><span class="comment">// 后期显示</span></span><br><span class="line">ctx.stroke(rectangle);</span><br><span class="line">ctx.fill(circle);</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53ab504cecfc4fbda07cfae9dd927071~tplv-k3u1fbpfcp-zoom-1.image" alt="路径"></p>
<p><code>Path2D</code>对象，用来缓存或记录绘画命令，这样能快速地回顾路径。所有的路径方法比如 moveTo, rect, arc 等，都可以在 Path2D 中使用。</p>
<h2 id="保存状态和恢复状态"><a href="#保存状态和恢复状态" class="headerlink" title="保存状态和恢复状态"></a>保存状态和恢复状态</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 画黑色，保存状态</span></span><br><span class="line">ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">150</span>, <span class="number">150</span>);</span><br><span class="line">ctx.save();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 换蓝色画一个，再保存状态</span></span><br><span class="line">ctx.fillStyle = <span class="string">"#09F"</span>;</span><br><span class="line">ctx.fillRect(<span class="number">15</span>, <span class="number">15</span>, <span class="number">120</span>, <span class="number">120</span>);</span><br><span class="line">ctx.save();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 换白色画一个，不保存状态</span></span><br><span class="line">ctx.fillStyle = <span class="string">"#FFF"</span>;</span><br><span class="line">ctx.globalAlpha = <span class="number">0.5</span>;</span><br><span class="line">ctx.fillRect(<span class="number">30</span>, <span class="number">30</span>, <span class="number">90</span>, <span class="number">90</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复上一个状态，也就是蓝色</span></span><br><span class="line">ctx.restore();</span><br><span class="line">ctx.fillRect(<span class="number">45</span>, <span class="number">45</span>, <span class="number">60</span>, <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复上上一个状态，也就是黑色</span></span><br><span class="line">ctx.restore();</span><br><span class="line">ctx.fillRect(<span class="number">60</span>, <span class="number">60</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/467277f838984009a5295901fd1807c1~tplv-k3u1fbpfcp-zoom-1.image" alt="保存和恢复状态"></p>
<p>Canvas 的状态就是当前画面应用的所有样式和变形的一个快照，而保存状态和恢复状态是绘制复杂图形时必不可少的方法：</p>
<ul>
<li><code>save()</code>，保存画布(canvas)的所有状态，无参数。当<code>save()</code>方法被调用后，当前的状态就被推送到栈中保存。状态包括之前提到过的各种属性、变形、裁切路径。</li>
<li><code>restore()</code>，恢复 canvas 状态，无参数。当<code>restore()</code>方法被调用后，上一个保存的状态就从栈中弹出，相应的设定都恢复。</li>
</ul>
<h2 id="移动坐标原点"><a href="#移动坐标原点" class="headerlink" title="移动坐标原点"></a>移动坐标原点</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// 将原始状态保存</span></span><br><span class="line">  ctx.save();</span><br><span class="line">  <span class="comment">// 移动原点，画方块</span></span><br><span class="line">  drawSquare(i);</span><br><span class="line">  <span class="comment">// 画完之后，重置回到原始状态</span></span><br><span class="line">  ctx.restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawSquare</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  ctx.fillStyle = <span class="string">"#f69"</span>;</span><br><span class="line">  <span class="comment">// 移动原点</span></span><br><span class="line">  ctx.translate(<span class="number">10</span>, <span class="number">10</span> + i * <span class="number">50</span>);</span><br><span class="line">  <span class="comment">// 始终在(0,0)画</span></span><br><span class="line">  ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">25</span>, <span class="number">25</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c2f772dfae9049dc896e26feb40f7498~tplv-k3u1fbpfcp-zoom-1.image" alt="移动原点2"><br><code>translate(x, y)</code>，x 是左右偏移量，y 是上下偏移量，如下图所示。<br><strong>移动原点前记得保存状态，这样方便恢复状态，不然最后你可能会走到外太空。</strong><br>移动 canvas 原点的好处：调整坐标之后，可以不用调整绘制的位置，这样很多时候更好理解和循环使用。<br><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/581c20c6b28a49328b01a8cec67de48b~tplv-k3u1fbpfcp-zoom-1.image" alt="移动原点"></p>
<h2 id="旋转坐标轴"><a href="#旋转坐标轴" class="headerlink" title="旋转坐标轴"></a>旋转坐标轴</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// 将原始状态保存</span></span><br><span class="line">  ctx.save();</span><br><span class="line">  <span class="comment">// 旋转坐标轴，画方块</span></span><br><span class="line">  drawSquare(i);</span><br><span class="line">  <span class="comment">// 画完之后，重置回到原始状态</span></span><br><span class="line">  ctx.restore();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 角度换算成弧度</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRadianFromAngle</span>(<span class="params">angle</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">Math</span>.PI / <span class="number">180</span>) * angle;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawSquare</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  ctx.fillStyle = <span class="string">`rgb(<span class="subst">$&#123;<span class="number">51</span> * i&#125;</span>,<span class="subst">$&#123;<span class="number">255</span> - <span class="number">51</span> * i&#125;</span>,255)`</span>;</span><br><span class="line">  <span class="comment">// 旋转坐标轴</span></span><br><span class="line">  ctx.rotate(getRadianFromAngle(<span class="number">30</span> * i));</span><br><span class="line">  <span class="comment">// 始终在(0,0)画</span></span><br><span class="line">  ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">80</span>, <span class="number">80</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cca6cf3b5cc642438bf908b0eb5205f5~tplv-k3u1fbpfcp-zoom-1.image" alt="旋转坐标轴"></p>
<p><code>rotate(radian)</code>，旋转坐标轴的角度(以弧度为单位)，它是顺时针方向的。旋转的中心点始终是坐标原点，如果要改变它，我们需要用到 <code>translate</code> 方法。同样记得旋转前保存下状态。</p>
<h2 id="缩放网格"><a href="#缩放网格" class="headerlink" title="缩放网格"></a>缩放网格</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// 将原始状态保存</span></span><br><span class="line">  ctx.save();</span><br><span class="line">  <span class="comment">// 缩放网格，画方块</span></span><br><span class="line">  drawSquare(i);</span><br><span class="line">  <span class="comment">// 画完之后，重置回到原始状态</span></span><br><span class="line">  ctx.restore();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawSquare</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  ctx.fillStyle = <span class="string">`rgb(<span class="subst">$&#123;<span class="number">51</span> * i&#125;</span>,<span class="subst">$&#123;<span class="number">255</span> - <span class="number">51</span> * i&#125;</span>,255)`</span>;</span><br><span class="line">  <span class="comment">// 缩放网格</span></span><br><span class="line">  ctx.scale(<span class="number">1</span>, (i + <span class="number">1</span>) * <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 同样是20*20，但是y轴上的1个网格本来表示1px,现在就相当于缩放的像素，表面看竖直方向被拉伸</span></span><br><span class="line">  ctx.fillRect(<span class="number">0</span>, <span class="number">10</span> * i, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28496e2291b34afc9ccc2ac9b12b5bfe~tplv-k3u1fbpfcp-zoom-1.image" alt="缩放网格"></p>
<p><code>scale(x, y)</code>，可以缩放画布的水平和垂直的单位。两个参数都是实数，可以为负数，x 为水平缩放因子，y 为垂直缩放因子，如果比 1 小，会比缩放图形， 如果比 1 大会放大图形。默认值为 1， 为实际大小。<br>画布初始情况下， 是以左上角坐标为原点的第一象限。如果参数为负实数， 相当于以 x 或 y 轴作为对称轴镜像反转（例如， 使用 translate(0,canvas.height); scale(1,-1); 以 y 轴作为对称轴镜像反转， 就可得到著名的笛卡尔坐标系，左下角为原点）。</p>
<h2 id="一次性设置原点、旋转、缩放"><a href="#一次性设置原点、旋转、缩放" class="headerlink" title="一次性设置原点、旋转、缩放"></a>一次性设置原点、旋转、缩放</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawSquare</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  ctx.fillStyle = <span class="string">`rgb(<span class="subst">$&#123;<span class="number">51</span> * i&#125;</span>,<span class="subst">$&#123;<span class="number">255</span> - <span class="number">51</span> * i&#125;</span>,255)`</span>;</span><br><span class="line">  <span class="comment">// 缩放网格</span></span><br><span class="line">  <span class="comment">// ctx.scale(1,(i+1)*1);</span></span><br><span class="line">  <span class="comment">// 等同于</span></span><br><span class="line">  ctx.transform(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, (i + <span class="number">1</span>) * <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  ctx.fillRect(<span class="number">0</span>, <span class="number">10</span> * i, <span class="number">20</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>transform(a, b, c, d, e, f)</code>，这个方法是将当前的变形矩阵乘上一个基于自身参数的矩阵。a 水平方向的缩放，b 竖直方向的倾斜偏移，c 水平方向的倾斜偏移，d 竖直方向的缩放，e(dx)水平方向的移动，f(dy) 竖直方向的移动。如果任意一个参数是 Infinity，变形矩阵也必须被标记为无限大，否则会抛出异常。</li>
<li><code>setTransform(a, b, c, d, e, f)</code>，这个方法会将当前的变形矩阵重置为单位矩阵，然后用相同的参数调用 <code>transform</code> 方法。从根本上来说，该方法是取消了当前变形,然后设置为指定的变形,一步完成。</li>
<li><code>resetTransform()</code>重置当前变形为单位矩阵，它和调用以下语句是一样的：<code>ctx.setTransform(1, 0, 0, 1, 0, 0)</code>;</li>
</ul>
<h2 id="操作图像"><a href="#操作图像" class="headerlink" title="操作图像"></a>操作图像</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式</span></span><br><span class="line"><span class="comment">// html那边加一行代码    &lt;img id='canvasImg' style='display: none;' src="https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/avatar-panda.png" alt=""&gt;</span></span><br><span class="line"><span class="keyword">var</span> domImg = <span class="built_in">document</span>.querySelector(<span class="string">"#canvasImg"</span>);</span><br><span class="line">domImg.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 图片放在哪</span></span><br><span class="line">  ctx.drawImage(domImg, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式</span></span><br><span class="line"><span class="keyword">var</span> urlImg = <span class="keyword">new</span> Image();</span><br><span class="line"><span class="comment">// 这里的src可以是</span></span><br><span class="line">urlImg.src =</span><br><span class="line">  <span class="string">"https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/avatar-panda.png"</span>;</span><br><span class="line">urlImg.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 图片放在哪，图片可以设置宽高</span></span><br><span class="line">  ctx.drawImage(urlImg, <span class="number">100</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式</span></span><br><span class="line"><span class="keyword">var</span> urlImg2 = <span class="keyword">new</span> Image();</span><br><span class="line">urlImg2.src =</span><br><span class="line">  <span class="string">"https://blog-huahua.oss-cn-beijing.aliyuncs.com/blog/code/avatar-panda.png"</span>;</span><br><span class="line">urlImg2.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 前四个参数是在原图片上，先找到剪切的点比如这里从图片左上角开始，然后剪切多长多宽如这里是50长宽</span></span><br><span class="line">  <span class="comment">// 后四个参数是将刚刚切出来的图片，放在画布的哪个位置比如100/60，然后在画布上面图片的宽高(比例不对图片会被拉伸)比如25/50</span></span><br><span class="line">  ctx.drawImage(urlImg2, <span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">50</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c6ae51dfc2a4a89ae7a21446ae4b1dd~tplv-k3u1fbpfcp-zoom-1.image" alt="图像"><br>操作图像是 canvas 很重要的能力，可以合成新的图片等等。</p>
<p>引入图像到 canvas 需要两个步骤：</p>
<ul>
<li>1.获取图片源，图片源可以是<ul>
<li>已存在的 canvas</li>
<li>已存在的 img 元素，</li>
<li>也可以创建 Image 元素，其中的 src 可以是<code>相对地址、绝对地址、data:url、视频的某帧</code></li>
</ul>
</li>
<li>2.使用 drawImage()函数将图片绘制到画布上，drawImage 有三种使用方式<ul>
<li><code>context.drawImage(img,x,y);</code>，在画布上定位图像</li>
<li><code>context.drawImage(img,x,y,width,height);</code>，在画布上定位图像，并规定图像的宽度和高度</li>
<li><code>context.drawImage(img,sx,sy,swidth,sheight,x,y,width,height)</code>，剪切图像，并在画布上定位被剪切的部分(s 是 slice 切片的意思)。</li>
</ul>
</li>
</ul>
<h2 id="合成和裁剪"><a href="#合成和裁剪" class="headerlink" title="合成和裁剪"></a>合成和裁剪</h2><h3 id="合成"><a href="#合成" class="headerlink" title="合成"></a>合成</h3><p><code>globalCompositeOperation = type</code>，如何将一个源（新的）图像绘制到目标（已有）的图像上。，其值是一个标识 12 种遮盖方式的字符串。默认值是<code>source-over</code>，在目标图像上显示源图像。<br><a href="https://www.w3school.com.cn/tags/canvas_globalcompositeoperation.asp" target="_blank" rel="noopener">w3school 的对 12 种绘制方式解释的很到位</a></p>
<h3 id="裁剪"><a href="#裁剪" class="headerlink" title="裁剪"></a>裁剪</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"><span class="comment">// 如果准备裁剪，先存下初始状态，以方便重置</span></span><br><span class="line">ctx.save();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 画一个矩形轮廓</span></span><br><span class="line">ctx.rect(<span class="number">50</span>, <span class="number">50</span>, <span class="number">40</span>, <span class="number">40</span>);</span><br><span class="line">ctx.stroke();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用clip就表示之后的绘图，只有矩形范围内的才能看见</span></span><br><span class="line">ctx.clip();</span><br><span class="line"></span><br><span class="line">ctx.beginPath();</span><br><span class="line"><span class="comment">// 虽然矩形外也有，但是看不见</span></span><br><span class="line">ctx.rect(<span class="number">40</span>, <span class="number">40</span>, <span class="number">30</span>, <span class="number">30</span>);</span><br><span class="line">ctx.fill();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 恢复初始状态</span></span><br><span class="line">ctx.restore();</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/75c72f2906934832bb2d2e2b8c7059b1~tplv-k3u1fbpfcp-zoom-1.image" alt="裁剪"></p>
<p><code>clip()</code>将当前正在构建的路径转换为当前的裁剪路径，之后的绘图只会显示在裁剪路径内。在特定区域里绘制图形时相当好用。<br>一旦剪切了某个区域，则所有之后的绘图都会被限制在被剪切的区域内（不能访问画布上的其他区域）。所以使用 <code>clip()</code> 方法前保存状态，方便之后恢复。</p>
<h2 id="动起来"><a href="#动起来" class="headerlink" title="动起来"></a>动起来</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"><span class="comment">// 用对象将球的属性存起来，也方便使用</span></span><br><span class="line"><span class="keyword">var</span> ball = &#123;</span><br><span class="line">  x: <span class="number">10</span>,</span><br><span class="line">  y: <span class="number">10</span>,</span><br><span class="line">  vx: <span class="number">5</span>,</span><br><span class="line">  vy: <span class="number">5</span>,</span><br><span class="line">  radius: <span class="number">10</span>,</span><br><span class="line">  color: <span class="string">"#f69"</span>,</span><br><span class="line">  draw() &#123;</span><br><span class="line">    ctx.beginPath();</span><br><span class="line">    <span class="comment">// 画圆</span></span><br><span class="line">    ctx.arc(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y, <span class="keyword">this</span>.radius, <span class="number">0</span>, <span class="built_in">Math</span>.PI * <span class="number">2</span>, <span class="literal">true</span>);</span><br><span class="line">    ctx.closePath();</span><br><span class="line">    ctx.fillStyle = <span class="keyword">this</span>.color;</span><br><span class="line">    ctx.fill();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> raf;</span><br><span class="line"><span class="comment">// 画每帧的关键函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">draw</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 清除画布</span></span><br><span class="line">  ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, canvas.width, canvas.height);</span><br><span class="line">  ball.draw();</span><br><span class="line">  <span class="comment">// 设置小球的下一次位置</span></span><br><span class="line">  ball.x += ball.vx;</span><br><span class="line">  ball.y += ball.vy;</span><br><span class="line">  <span class="comment">// 动画的关键</span></span><br><span class="line">  raf = <span class="built_in">window</span>.requestAnimationFrame(draw);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 小球先显示出来</span></span><br><span class="line">ball.draw();</span><br><span class="line"><span class="comment">// 鼠标在canvas的时候，动画启动</span></span><br><span class="line">canvas.addEventListener(<span class="string">"mouseover"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  raf = <span class="built_in">window</span>.requestAnimationFrame(draw);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 动画取消</span></span><br><span class="line">canvas.addEventListener(<span class="string">"mouseout"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">window</span>.cancelAnimationFrame(raf);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93aa4abc814c41b0b8cce521e5da6b2d~tplv-k3u1fbpfcp-zoom-1.image" alt="动画"></p>
<p>canvas 做动画也是挺炫酷的，做动画的基本步骤：</p>
<ul>
<li>清空 canvas。一般动画一帧一帧的画，如果不需要上一帧的话，直接清除整个画布即可<code>ctx.clearRect(0, 0, canvas.width, canvas.height);</code></li>
<li>适当保存 canvas 的状态。如果画图形的时候涉及到样式变形之类的，记得要保存状态，以便随时恢复。</li>
<li>绘制每帧。这步大概率是重复进行的，以此实现动画的效果 setTimeout/setInterval/requestAnimationFrame</li>
<li>恢复 canvas 的状态</li>
</ul>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Advanced_animations" target="_blank" rel="noopener">当然还可以增加边界、加速度以及有个酷酷的小尾巴。</a> 其他精彩动画，如实现时钟、贪吃蛇之类的也有详细代码。</p>
<h2 id="控制每个像素的颜色"><a href="#控制每个像素的颜色" class="headerlink" title="控制每个像素的颜色"></a>控制每个像素的颜色</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line"><span class="comment">// 创建10*10像素的图片数据，data是数组，100*100*4的长度</span></span><br><span class="line"><span class="keyword">var</span> imgData = ctx.createImageData(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"><span class="comment">// 每四项表示一个像素的颜色，分别表示rgba，换言之imgData.data.length始终是总网格的4倍</span></span><br><span class="line"><span class="built_in">console</span>.log(imgData);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; imgData.data.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">  setGridColor(imgData, i, <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">  <span class="comment">// 超过一半就换个颜色</span></span><br><span class="line">  <span class="keyword">if</span> (i &gt;= imgData.data.length / <span class="number">2</span>) &#123;</span><br><span class="line">    setGridColor(imgData, i, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ctx.putImageData(imgData, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// [0,255,0,255]</span></span><br><span class="line"><span class="built_in">console</span>.log(getGridColor(imgData, <span class="number">11</span>, <span class="number">11</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 得到位于(100,100)位置的10*10像素的图像数据</span></span><br><span class="line"><span class="keyword">var</span> specialImgData = ctx.getImageData(<span class="number">100</span>, <span class="number">100</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line"><span class="comment">// 将其变成蓝色</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; specialImgData.data.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">  setGridColor(specialImgData, i, <span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 再次填充到画布上，其实这样就可以对图片进行各种滤镜处理之类的了</span></span><br><span class="line">ctx.putImageData(specialImgData, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.log();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置某个网格的颜色信息</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setGridColor</span>(<span class="params">imgData, i, r, g, b, a</span>) </span>&#123;</span><br><span class="line">  imgData.data[i + <span class="number">0</span>] = r;</span><br><span class="line">  imgData.data[i + <span class="number">1</span>] = g;</span><br><span class="line">  imgData.data[i + <span class="number">2</span>] = b;</span><br><span class="line">  imgData.data[i + <span class="number">3</span>] = a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 得到某行某列的特定网格的像素信息</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getGridColor</span>(<span class="params">imageData, row, column</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rIndex = row * (imageData.width * <span class="number">4</span>) + column * <span class="number">4</span> + <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> imageData.data.slice(rIndex, rIndex + <span class="number">4</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 设置特定某行某列网格的颜色信息</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setSpecialGridColor</span>(<span class="params">imageData, row, column, r, g, b, a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> rIndex = row * (imageData.width * <span class="number">4</span>) + column * <span class="number">4</span> + <span class="number">0</span>;</span><br><span class="line">  imageData.data[rIndex] = r;</span><br><span class="line">  imageData.data[rIndex + <span class="number">1</span>] = g;</span><br><span class="line">  imageData.data[rIndex + <span class="number">2</span>] = b;</span><br><span class="line">  imageData.data[rIndex + <span class="number">3</span>] = a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ede9331cd21b4e3b84f51098dca2d700~tplv-k3u1fbpfcp-zoom-1.image" alt="像素控制"></p>
<ul>
<li><code>createImageData(width,height)</code> 方法创建新的空白 ImageData 对象。ImageData 的<code>data</code>存了所有的像素信息，是一个数组，每四项对应一个像素的 rgba 信息(a 的话 0 是透明，255 是完全可见)，默认是(0,0,0,0)。如数组的 0,1,2,3 对应第一个像素，4,5,6,7 对应第二个像素。 长度是<code>高度 × 宽度 × 4</code> ，索引值从 0 到<code>长度-1</code></li>
<li><code>putImageData(imgData,x,y)</code> 方法将图像数据（从指定的 ImageData 对象）放回画布特定位置上</li>
<li><code>getImageData(left, top, width, height)</code>，这个方法会返回一个 ImageData 对象，它代表了画布区域的对象数据，此画布的四个角落分别表示为(left, top), (left + width, top), (left, top + height), 以及(left + width, top + height)四个点。这些坐标点被设定为画布坐标空间元素。</li>
</ul>
<!-- ## 反锯齿

默认反锯齿是开启的。`imageSmoothingEnabled` -->
<h2 id="上传和下载-canvas-绘制的图片"><a href="#上传和下载-canvas-绘制的图片" class="headerlink" title="上传和下载 canvas 绘制的图片"></a>上传和下载 canvas 绘制的图片</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">"tutorial"</span>);</span><br><span class="line"><span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>);</span><br><span class="line">ctx.fillRect(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取图片的base64</span></span><br><span class="line"><span class="keyword">var</span> base64 = canvas.toDataURL(<span class="string">"image/png"</span>, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">"#canvasImg"</span>).src = base64;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(base64);</span><br><span class="line"><span class="comment">// 也可以下载到本地</span></span><br><span class="line"><span class="comment">// openDownloadDialog(base64, `随便起名.png`);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以拿到blob对象，像File那样处理</span></span><br><span class="line">canvas.toBlob(<span class="function"><span class="params">blobObj</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(blobObj);</span><br><span class="line">  <span class="comment">// 当然也可以下载到本地</span></span><br><span class="line">  openDownloadDialog(blobObj, <span class="string">`随便起名blob.png`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里的blob可以是blob文件也可以是base64</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openDownloadDialog</span>(<span class="params">blob, fileName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> blob === <span class="string">"object"</span> &amp;&amp; blob <span class="keyword">instanceof</span> Blob) &#123;</span><br><span class="line">    blob = URL.createObjectURL(blob); <span class="comment">// 创建blob地址</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> aLink = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>);</span><br><span class="line">  aLink.href = blob;</span><br><span class="line">  <span class="comment">// HTML5新增的属性，指定保存文件名，可以不要后缀，注意，有时候 file:///模式下不会生效</span></span><br><span class="line">  aLink.download = fileName || <span class="string">""</span>;</span><br><span class="line">  <span class="keyword">var</span> event;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.MouseEvent) event = <span class="keyword">new</span> MouseEvent(<span class="string">"click"</span>);</span><br><span class="line">  <span class="comment">// 移动端</span></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    event = <span class="built_in">document</span>.createEvent(<span class="string">"MouseEvents"</span>);</span><br><span class="line">    event.initMouseEvent( <span class="string">"click"</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="built_in">window</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="number">0</span>, <span class="literal">null</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  aLink.dispatchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/745d2a9741fc4178b177596de740c146~tplv-k3u1fbpfcp-zoom-1.image" alt="保存和下载"></p>
<ul>
<li><code>canvas.toDataURL(&#39;image/png&#39;)</code>，默认设定。创建一个PNG图片。</li>
<li><code>canvas.toDataURL(&#39;image/jpeg&#39;, quality)</code>，创建一个JPG图片。可以有选择地提供从0到1的品质量，1表示最好品质，0基本不被辨析但有比较小的文件大小。</li>
<li><code>canvas.toBlob(callback, type, encoderOptions)</code>创建了一个在画布中的代表图片的Blob对像。</li>
</ul>
<h2 id="可能用到的canvas代码片段"><a href="#可能用到的canvas代码片段" class="headerlink" title="可能用到的canvas代码片段"></a>可能用到的canvas代码片段</h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/Code_snippets/Canvas" target="_blank" rel="noopener">mdn写的很详细，不粘贴了。</a></p>
<ul>
<li>在画布中获取特定颜色的像素数量</li>
<li>在画布中获取某一个像素的颜色</li>
<li>链式调用方法</li>
<li>将canvas图片保存到文件中</li>
<li>将一个远程页面加载到canvas元素上</li>
<li>将图像文件转换为base64字符串</li>
</ul>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><blockquote>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial" target="_blank" rel="noopener">MDN 的 Canvas 教程</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/Code_snippets/Canvas" target="_blank" rel="noopener">MDN 的canvas可能用到的代码片段</a><br><a href="https://www.w3school.com.cn/tags/html_ref_canvas.asp" target="_blank" rel="noopener">w3school 的 canvas 教程</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/27/create-md5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/09/27/create-md5/" itemprop="url">
                  怎么给文件生成MD5
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-09-27T15:53:42+08:00">
                2020-09-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/09/27/create-md5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/09/27/create-md5/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>MD5</code> 的核心是通过算法把任意长度的原始数据映射成128 bit 的数据。把一串数据经过处理，得到另一个固定长度的数据。是一种<code>Hash</code>算法，全称为 消息摘要算法版本5（Message Digest Algorithm 5）。</p>
<p>不同原始数据会有不同的 MD5 值。 所以不同的文件MD5的值也不一样。</p>
<p>一般在上传文件的场景里，会根据<code>MD5</code>实现续传、秒传的功能。</p>
<p>本文简单写下怎么生成 MD5，这里用到插件<a href="https://github.com/satazor/js-spark-md5" target="_blank" rel="noopener"><code>spark-md5</code></a>。</p>
<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul>
<li>怕麻烦，10M以内生成MD5，直接用法一就行</li>
<li>怕麻烦，30M以内生成MD5，直接用法二就行</li>
<li>再大一点，用法三吧</li>
<li>但法三可以用在以上所有场景</li>
</ul>
<h2 id="法一：生成文件的-MD5"><a href="#法一：生成文件的-MD5" class="headerlink" title="法一：生成文件的 MD5"></a>法一：生成文件的 MD5</h2><p>生成文件的 MD5，简单思路如下：</p>
<ul>
<li>创建 FileReader 实例，读文件</li>
<li>读完之后，成功状态下，直接使用<code>SparkMD5.hashBinary</code>。</li>
</ul>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fde1e7bbd9734cc887112930c37f571f~tplv-k3u1fbpfcp-zoom-1.image" alt="生成小文件的MD5"></p>
<p>具体代码在文末。</p>
<h3 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h3><p>这种方式，当文件越大的时候，生成 md5 的速度也就越慢，比如 40M 的文件可能需要 1s 才生成 md5。当页面还有其他的交互的时候，将会堵塞其他交互，导致页面假死状态。<br><!-- 引起 UI 的阻塞，导致页面假死状态 --></p>
<p>举个例子：加个按钮，写个点击事件。选择文件之后，立即点击按钮，会发现，当文件越大的时候，弹框的速度越来越迟钝。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"upload"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">onchange</span>=<span class="string">"selectLocalFile"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里加个按钮，选择文件完之后 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"alert(1)"</span>&gt;</span>测试线程堵塞<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  upload.onchange = async (e) =&gt; &#123;</span></span><br><span class="line"><span class="undefined">    const file = e.target.files[0];</span></span><br><span class="line"><span class="undefined">    console.time("timeCreateMd5");</span></span><br><span class="line"><span class="undefined">    const md5 = await createFileMd5(file);</span></span><br><span class="line"><span class="undefined">    console.log(file.size);</span></span><br><span class="line"><span class="undefined">    //  会打印timeCreateMd5: 959.31396484375 ms</span></span><br><span class="line"><span class="undefined">    console.timeEnd("timeCreateMd5");</span></span><br><span class="line"><span class="undefined">  &#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="法二：在worker中生成md5"><a href="#法二：在worker中生成md5" class="headerlink" title="法二：在worker中生成md5"></a>法二：在worker中生成md5</h2><p>所以我们使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener"><code>web-worker</code></a> 在 <code>worker 线程</code>计算 <code>hash</code>，这样用户仍可以在主界面正常的交互，不会引起堵塞。<br>当前页面的修改，如下：</p>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7c131af0dd01404bbba9744b04539f34~tplv-k3u1fbpfcp-zoom-1.image" alt="md5"></p>
<p>新增在worker里执行的<code>hash.js</code>文件如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">self.importScripts(<span class="string">"https://unpkg.com/spark-md5@3.0.1/spark-md5.min.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成文件 hash</span></span><br><span class="line">self.onmessage = <span class="keyword">async</span> e =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = e.data</span><br><span class="line">  <span class="keyword">const</span> md5 = <span class="keyword">await</span> createFileMd5(file)</span><br><span class="line">  self.postMessage(md5);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFileMd5</span>(<span class="params">file</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// 同之前的，但以下需要修改，增加self的前缀</span></span><br><span class="line">  isSuccess</span><br><span class="line">        ? resolve(self.SparkMD5.hashBinary(result))</span><br><span class="line">        : reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"读取出错了"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到这，其实虽然生成大文件的md5耗费时间长，但起码不会堵塞页面主线程了。</p>
<h3 id="也有缺陷"><a href="#也有缺陷" class="headerlink" title="也有缺陷"></a>也有缺陷</h3><p>可以看到计算md5是将整个文件读完才看到，这样当文件过大是极其耗内存的。所以需要分片读取生成<code>md5</code>。</p>
<h2 id="法三：将文件分片生成md5"><a href="#法三：将文件分片生成md5" class="headerlink" title="法三：将文件分片生成md5"></a>法三：将文件分片生成md5</h2><p>仔细看<a href="https://github.com/satazor/js-spark-md5" target="_blank" rel="noopener">spark-md5</a>，其实作者也是推荐分片读取，类似nodejs里面的流一样，这样不需要占据大量内存。</p>
<p>先将文件，按照一定大小分块chunk，这边直接使用<code>File.slice</code>了。  </p>
<p>然后将chunks传给另一个线程计算md5，这边大文件可能需要进度条，所以有一个进度，按需求使用。</p>
<p><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/914521b27b014a22a3141abb6b01c246~tplv-k3u1fbpfcp-zoom-1.image" alt="Chunks"><br><img src="//p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dc3b958aed1e43499e297714dd9080ea~tplv-k3u1fbpfcp-zoom-1.image" alt="hash"></p>
<h2 id="附注：代码"><a href="#附注：代码" class="headerlink" title="附注：代码"></a>附注：代码</h2><h3 id="代码：生成小文件的-MD5"><a href="#代码：生成小文件的-MD5" class="headerlink" title="代码：生成小文件的 MD5"></a>代码：生成小文件的 MD5</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"upload"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">onchange</span>=<span class="string">"selectLocalFile"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/spark-md5@3.0.1/spark-md5.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">"#upload"</span>);</span></span><br><span class="line"><span class="javascript">      upload.onchange = <span class="keyword">async</span> (e) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> file = e.target.files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> md5 = <span class="keyword">await</span> createFileMd5(file);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(md5);</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">createFileMd5</span>(<span class="params">file</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 创建FileReader实例</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> fileReader = <span class="keyword">new</span> FileReader();</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 开始读文件</span></span></span><br><span class="line"><span class="undefined">          fileReader.readAsBinaryString(file);</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 文件读完之后，触发load事件</span></span></span><br><span class="line"><span class="javascript">          fileReader.onload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// e.target就是fileReader实例</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(e.target);</span></span><br><span class="line"><span class="javascript">            <span class="comment">// result是fileReader读到的部分</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> result = e.target.result;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 如果读到的长度和文件长度一致，则读取成功</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> isSuccess = file.size === result.length;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 读取成功，则生成MD5，扔出去。失败就报错</span></span></span><br><span class="line"><span class="undefined">            isSuccess</span></span><br><span class="line"><span class="undefined">              ? resolve(SparkMD5.hashBinary(result))</span></span><br><span class="line"><span class="javascript">              : reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"读取出错了"</span>));</span></span><br><span class="line"><span class="undefined">          &#125;;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//   读取过程中出错也直接报错</span></span></span><br><span class="line"><span class="javascript">          fileReader.onerror = <span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"读取出错了"</span>));</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="代码：在worker中生成md5"><a href="#代码：在worker中生成md5" class="headerlink" title="代码：在worker中生成md5"></a>代码：在worker中生成md5</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"upload"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">onchange</span>=<span class="string">"selectLocalFile"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"alert(1)"</span>&gt;</span>测试线程堵塞<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">"#upload"</span>);</span></span><br><span class="line"><span class="javascript">      upload.onchange = <span class="keyword">async</span> (e) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> file = e.target.files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.time(<span class="string">"timeCreateMd5"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> md5 = <span class="keyword">await</span> createFileMd5InWorker(file);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(file.size);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.timeEnd(<span class="string">"timeCreateMd5"</span>);</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 生成文件 md5（web-worker）</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">createFileMd5InWorker</span>(<span class="params">file</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 新建worker线程,执行hash.js</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> worker = <span class="keyword">new</span> Worker(<span class="string">"./hash.js"</span>);</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 给线程传file</span></span></span><br><span class="line"><span class="undefined">          worker.postMessage(file);</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 当线程传消息的时候，接受消息</span></span></span><br><span class="line"><span class="javascript">          worker.onmessage = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> md5 = e.data;</span></span><br><span class="line"><span class="undefined">            md5 &amp;&amp; resolve(md5)</span></span><br><span class="line"><span class="undefined">          &#125;;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hash.js</span></span><br><span class="line">self.importScripts(<span class="string">"https://unpkg.com/spark-md5@3.0.1/spark-md5.min.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成文件 md5</span></span><br><span class="line">self.onmessage = <span class="keyword">async</span> e =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> file = e.data</span><br><span class="line">  <span class="keyword">const</span> md5 = <span class="keyword">await</span> createFileMd5(file)</span><br><span class="line">  self.postMessage(md5);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFileMd5</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 创建FileReader实例</span></span><br><span class="line">    <span class="keyword">const</span> fileReader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    <span class="comment">// 开始读文件</span></span><br><span class="line">    fileReader.readAsBinaryString(file);</span><br><span class="line">    <span class="comment">// 文件读完之后，触发load事件</span></span><br><span class="line">    fileReader.onload = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// e.target就是fileReader实例，这里用this也是指fileReader实例</span></span><br><span class="line">      <span class="built_in">console</span>.log(e.target);</span><br><span class="line">      <span class="comment">// result是fileReader读到的部分</span></span><br><span class="line">      <span class="keyword">const</span> result = e.target.result;</span><br><span class="line">      <span class="comment">// 如果读到的长度和文件长度一致，则读取成功</span></span><br><span class="line">      <span class="keyword">const</span> isSuccess = file.size === result.length;</span><br><span class="line">      <span class="comment">// 读取成功，则生成MD5，扔出去。失败就报错</span></span><br><span class="line">      isSuccess</span><br><span class="line">        ? resolve(self.SparkMD5.hashBinary(result))</span><br><span class="line">        : reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"读取出错了"</span>));</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//   读取过程中出错也直接报错</span></span><br><span class="line">    fileReader.onerror = <span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"读取出错了"</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="代码：分片读取生成md5"><a href="#代码：分片读取生成md5" class="headerlink" title="代码：分片读取生成md5"></a>代码：分片读取生成md5</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"upload"</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">onchange</span>=<span class="string">"selectLocalFile"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"alert(1)"</span>&gt;</span>测试线程堵塞<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> upload = <span class="built_in">document</span>.querySelector(<span class="string">"#upload"</span>);</span></span><br><span class="line"><span class="javascript">      upload.onchange = <span class="keyword">async</span> (e) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> file = e.target.files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> chunks = createFileChunk(file)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.time(<span class="string">"timeCreateMd5"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 这里注意放chunks</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> &#123;md5&#125; = <span class="keyword">await</span> createFileMd5InWorker(chunks);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(file.size);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.timeEnd(<span class="string">"timeCreateMd5"</span>);</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined">      </span></span><br><span class="line"><span class="javascript">      <span class="comment">// 生成文件切片</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">createFileChunk</span>(<span class="params">file, size = <span class="number">4</span> * <span class="number">1024</span> * <span class="number">1024</span></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> chunks = [];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> cur = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">while</span> (cur &lt; file.size) &#123;</span></span><br><span class="line"><span class="undefined">          chunks.push(file.slice(cur, cur + size));</span></span><br><span class="line"><span class="undefined">          cur += size;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> chunks;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 生成文件 hash（web-worker）</span></span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">createFileMd5InWorker</span>(<span class="params">fileChunks</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> worker = <span class="keyword">new</span> Worker(<span class="string">"./hash.js"</span>);</span></span><br><span class="line"><span class="undefined">          worker.postMessage(&#123; fileChunks &#125;);</span></span><br><span class="line"><span class="javascript">          worker.onmessage = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 这边加了进度条 这里的进度条，看需要显示</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> &#123; percentage, hash &#125; = e.data;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(percentage)</span></span><br><span class="line"><span class="javascript">            <span class="comment">// 计算出hash之后，扔出去</span></span></span><br><span class="line"><span class="undefined">            hash &amp;&amp;resolve(hash);</span></span><br><span class="line"><span class="undefined">          &#125;;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接copy的  https://juejin.im/post/6844904046436843527#heading-17</span></span><br><span class="line">self.importScripts(<span class="string">"./js/lib/spark-md5.min.js"</span>); <span class="comment">// 导入脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成文件 hash</span></span><br><span class="line">self.onmessage = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; fileChunks &#125; = e.data;</span><br><span class="line">  <span class="built_in">console</span>.log(fileChunks)</span><br><span class="line"><span class="comment">//   const &#123; fileChunks &#125; = e.data;</span></span><br><span class="line">  <span class="keyword">const</span> spark = <span class="keyword">new</span> self.SparkMD5.ArrayBuffer();</span><br><span class="line">  <span class="keyword">let</span> percentage = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">const</span> loadNext = <span class="function"><span class="params">index</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">    reader.readAsArrayBuffer(fileChunks[index]);</span><br><span class="line">    reader.onload = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">      count++;</span><br><span class="line">      spark.append(e.target.result);</span><br><span class="line">      <span class="keyword">if</span> (count === fileChunks.length) &#123;</span><br><span class="line">        self.postMessage(&#123;</span><br><span class="line">          percentage: <span class="number">100</span>,</span><br><span class="line">          hash: spark.end()</span><br><span class="line">        &#125;);</span><br><span class="line">        self.close();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        percentage += <span class="number">100</span> / fileChunks.length;</span><br><span class="line">        self.postMessage(&#123;</span><br><span class="line">          percentage</span><br><span class="line">        &#125;);</span><br><span class="line">        loadNext(count);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  loadNext(<span class="number">0</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><ul>
<li><a href="https://juejin.im/post/6844904046436843527" target="_blank" rel="noopener">字节跳动面试官：请你实现一个大文件上传和断点续传</a></li>
<li><a href="http://blog.bfw.wiki/user10/15628273380201230054.html" target="_blank" rel="noopener">js 实现 input file 转换成 blob 和 byte 字节流</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/26592209" target="_blank" rel="noopener">三分钟学习md5</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/21/vue-style-guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="frontzhm">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://omizt4opc.bkt.clouddn.com/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="花花的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/09/21/vue-style-guide/" itemprop="url">
                  写vue的尽量按照规范来
                </a>
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-09-21T15:37:41+08:00">
                2020-09-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编辑器/" itemprop="url" rel="index">
                    <span itemprop="name">编辑器</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/09/21/vue-style-guide/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/09/21/vue-style-guide/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://cn.vuejs.org/v2/style-guide/index.html#%E8%A7%84%E5%88%99%E5%BD%92%E7%B1%BB" target="_blank" rel="noopener">官方的风格指南</a>。  </p>
<p>本文按照自己的逻辑，稍微简化了。规范的好处是，排雷更加容易，踩雷更加艰难，项目看着更赏心悦目。</p>
<h2 id="必要"><a href="#必要" class="headerlink" title="必要"></a>必要</h2><h3 id="组件名为多个单词"><a href="#组件名为多个单词" class="headerlink" title="组件名为多个单词"></a>组件名为多个单词</h3><p>这样做可以避免跟现有的以及未来的 HTML 元素相冲突。比如以前不小心写了个<code>masker</code>的组件，然不生效。</p>
<h3 id="Prop-定义应该尽量详细"><a href="#Prop-定义应该尽量详细" class="headerlink" title="Prop 定义应该尽量详细"></a>Prop 定义应该尽量详细</h3><p>在开发环境下，如果向一个组件提供格式不正确的 prop，Vue 将会告警，以帮助你捕获潜在的错误来源。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  status: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 更好的做法！</span></span><br><span class="line"></span><br><span class="line">props: &#123;</span><br><span class="line">  status: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">    validator: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'syncing'</span>,</span><br><span class="line">        <span class="string">'synced'</span>,</span><br><span class="line">        <span class="string">'version-conflict'</span>,</span><br><span class="line">        <span class="string">'error'</span></span><br><span class="line">      ].indexOf(value) !== <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="v-for必须设置key"><a href="#v-for必须设置key" class="headerlink" title="v-for必须设置key"></a>v-for必须设置key</h3><p>始终添加一个唯一的键值，以便你和你的团队永远不必担心一些极端情况。也在少数对性能有严格要求的情况下，为了避免对象固化，你可以刻意做一些非常规的处理。</p>
<h3 id="永远不要把-v-if-和-v-for-同时用在同一个元素上"><a href="#永远不要把-v-if-和-v-for-同时用在同一个元素上" class="headerlink" title="永远不要把 v-if 和 v-for 同时用在同一个元素上"></a>永远不要把 v-if 和 v-for 同时用在同一个元素上</h3><p>如果有这种场景，按照下面的方式改进，以优化性能</p>
<ol>
<li><p>过滤一个列表中的项目 (比如 v-for=”user in users” v-if=”user.isActive”)。在这种情形下，请将 users 替换为一个<code>计算属性</code> (比如 activeUsers)，让其返回过滤后的列表。</p>
</li>
<li><p>为了避免渲染本应该被隐藏的列表 (比如 v-for=”user in users” v-if=”shouldShowUsers”)。这种情形下，请将 v-if 移动至<code>容器元素</code>上 (比如 ul、ol)</p>
</li>
</ol>
<h2 id="强烈推荐"><a href="#强烈推荐" class="headerlink" title="强烈推荐"></a>强烈推荐</h2><h3 id="组件一律使用单文件申明，而不是Vue-component"><a href="#组件一律使用单文件申明，而不是Vue-component" class="headerlink" title="组件一律使用单文件申明，而不是Vue.component"></a>组件一律使用单文件申明，而不是Vue.component</h3><p>只要有能够拼接文件的构建系统，就把每个组件单独分成文件。</p>
<h3 id="组件的文件名的格式要么都是PascalCase，要么都是是kebab-case"><a href="#组件的文件名的格式要么都是PascalCase，要么都是是kebab-case" class="headerlink" title="组件的文件名的格式要么都是PascalCase，要么都是是kebab-case"></a>组件的文件名的格式要么都是PascalCase，要么都是是kebab-case</h3><p>但单词大写开头对于代码编辑器的自动补全最为友好，因为这使得我们在 JS(X) 和模板中引用组件的方式尽可能的一致。然而，混用文件命名方式有的时候会导致大小写不敏感的文件系统的问题，这也是横线连接命名同样完全可取的原因。</p>
<h3 id="基础组件名加特定前缀，比如-Base、App-或-V"><a href="#基础组件名加特定前缀，比如-Base、App-或-V" class="headerlink" title="基础组件名加特定前缀，比如 Base、App 或 V"></a>基础组件名加特定前缀，比如 Base、App 或 V</h3><p>应用特定样式和约定的基础组件 (也就是展示类的、无逻辑的或无状态的组件) 应该全部以一个特定的前缀开头，比如 Base、App 或 V。</p>
<p>好处：</p>
<ol>
<li><p>当你在编辑器中以字母顺序排序时，你的应用的基础组件会全部列在一起，这样更容易识别。</p>
</li>
<li><p>因为组件名应该始终是多个单词，所以这样做可以避免你在包裹简单组件时随意选择前缀 (比如 MyButton、VueButton)。</p>
</li>
<li><p>因为这些组件会被频繁使用，所以你可能想把它们放到全局而不是在各处分别导入它们。使用相同的前缀可以让 webpack 这样工作：</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> requireComponent = <span class="built_in">require</span>.context(<span class="string">"./src"</span>, <span class="literal">true</span>, /Base[A-Z]\w+\.(vue|js)$/)</span><br><span class="line">requireComponent.keys().forEach(<span class="function"><span class="keyword">function</span> (<span class="params">fileName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> baseComponentConfig = requireComponent(fileName)</span><br><span class="line">  baseComponentConfig = baseComponentConfig.default || baseComponentConfig</span><br><span class="line">  <span class="keyword">var</span> baseComponentName = baseComponentConfig.name || (</span><br><span class="line">    fileName</span><br><span class="line">      .replace(<span class="regexp">/^.+\//</span>, <span class="string">''</span>)</span><br><span class="line">      .replace(<span class="regexp">/\.\w+$/</span>, <span class="string">''</span>)</span><br><span class="line">  )</span><br><span class="line">  Vue.component(baseComponentName, baseComponentConfig)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="每个页面只能使用一次的组件应该以-The-前缀命名，以示其唯一性"><a href="#每个页面只能使用一次的组件应该以-The-前缀命名，以示其唯一性" class="headerlink" title="每个页面只能使用一次的组件应该以 The 前缀命名，以示其唯一性"></a>每个页面只能使用一次的组件应该以 The 前缀命名，以示其唯一性</h3><p>这不意味着组件只可用于一个单页面，而是每个页面只使用一次。这些组件永远不接受任何 prop，因为它们是为你的应用定制的，而不是它们在你的应用中的上下文。如果你发现有必要添加 prop，那就表明这实际上是一个可复用的组件，只是目前在每个页面里只使用一次</p>
<h3 id="紧密耦合的组件名依次加父组件前缀"><a href="#紧密耦合的组件名依次加父组件前缀" class="headerlink" title="紧密耦合的组件名依次加父组件前缀"></a>紧密耦合的组件名依次加父组件前缀</h3><p>如果一个组件只在某个父组件的场景下有意义，这层关系应该体现在其名字上。因为编辑器通常会按字母顺序组织文件，所以这样做可以把相关联的文件排在一起。不推荐文件夹嵌套。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">components/</span><br><span class="line">|- TodoList.vue</span><br><span class="line">|- TodoListItem.vue</span><br><span class="line">|- TodoListItemButton.vue</span><br></pre></td></tr></table></figure>
<h3 id="组件名中的单词顺序尽量让相关的在一起"><a href="#组件名中的单词顺序尽量让相关的在一起" class="headerlink" title="组件名中的单词顺序尽量让相关的在一起"></a>组件名中的单词顺序尽量让相关的在一起</h3><p>给组件命名时并不需要遵从自然语言。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">components/</span><br><span class="line">|- SearchButtonClear.vue</span><br><span class="line">|- SearchButtonRun.vue</span><br><span class="line">|- SearchInputExcludeGlob.vue</span><br><span class="line">|- SearchInputQuery.vue</span><br><span class="line">|- SettingsCheckboxLaunchOnStartup.vue</span><br><span class="line">|- SettingsCheckboxTerms.vue</span><br><span class="line"></span><br><span class="line"><span class="comment">// 而不是下面的，这样翻找很困难</span></span><br><span class="line">components/</span><br><span class="line">|- ClearSearchButton.vue</span><br><span class="line">|- ExcludeFromSearchInput.vue</span><br><span class="line">|- LaunchOnStartupCheckbox.vue</span><br><span class="line">|- RunSearchButton.vue</span><br><span class="line">|- SearchInput.vue</span><br><span class="line">|- TermsCheckbox.vue</span><br></pre></td></tr></table></figure>
<p>好处：</p>
<ol>
<li>在多级目录间找来找去，要比在单个 components 目录下滚动查找要花费更多的精力。</li>
<li>存在组件重名 (比如存在多个 ButtonDelete 组件) 的时候在编辑器里更难快速定位。</li>
<li>让重构变得更难，因为为一个移动了的组件更新相关引用时，查找/替换通常并不高效。</li>
</ol>
<h3 id="模板中组件名始终-kebab-case，-lt-my-component-gt-lt-my-component-gt"><a href="#模板中组件名始终-kebab-case，-lt-my-component-gt-lt-my-component-gt" class="headerlink" title="模板中组件名始终 kebab-case，&lt;my-component&gt;&lt;/my-component&gt;"></a>模板中组件名始终 kebab-case，<code>&lt;my-component&gt;&lt;/my-component&gt;</code></h3><p>对于绝大多数项目来说，在单文件组件和字符串模板中组件名应该总是 PascalCase 的——但是在 DOM 模板中总是 kebab-case 的。</p>
<h3 id="组件名应该倾向于完整单词而不是缩写"><a href="#组件名应该倾向于完整单词而不是缩写" class="headerlink" title="组件名应该倾向于完整单词而不是缩写"></a>组件名应该倾向于完整单词而不是缩写</h3><p>编辑器中的自动补全已经让书写长命名的代价非常之低了，而其带来的明确性却是非常宝贵的。不常用的缩写尤其应该避免。</p>
<h3 id="声明-prop的时候用-camelCase，在模板和-JSX-中用-kebab-case"><a href="#声明-prop的时候用-camelCase，在模板和-JSX-中用-kebab-case" class="headerlink" title="声明 prop的时候用 camelCase，在模板和 JSX 中用 kebab-case"></a>声明 prop的时候用 camelCase，在模板和 JSX 中用 kebab-case</h3><p>我们单纯的遵循每个语言的约定。在 JavaScript 中更自然的是 camelCase。而在 HTML 中则是 kebab-case。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">props: &#123;</span><br><span class="line">  greetingText: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">welcome-message</span> <span class="attr">greeting-text</span>=<span class="string">"hi"</span>&gt;</span><span class="tag">&lt;/<span class="name">welcome-message</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="多个-attribute-的元素-每个-attribute-一行"><a href="#多个-attribute-的元素-每个-attribute-一行" class="headerlink" title="多个 attribute 的元素,每个 attribute 一行"></a>多个 attribute 的元素,每个 attribute 一行</h3><p>在 JavaScript 中，用多行分隔对象的多个 property 是很常见的最佳实践，因为这样更易读。模板和 JSX 值得我们做相同的考虑。</p>
<h3 id="模板中只能用简单表达式，复杂的用computed"><a href="#模板中只能用简单表达式，复杂的用computed" class="headerlink" title="模板中只能用简单表达式，复杂的用computed"></a>模板中只能用简单表达式，复杂的用computed</h3><p>复杂表达式会让你的模板变得不那么声明式。我们应该尽量描述应该出现的是什么，而非如何计算那个值。而且计算属性和方法使得代码可以重用。</p>
<h3 id="应把复杂计算属性分割为尽可能多的更简单的-property"><a href="#应把复杂计算属性分割为尽可能多的更简单的-property" class="headerlink" title="应把复杂计算属性分割为尽可能多的更简单的 property"></a>应把复杂计算属性分割为尽可能多的更简单的 property</h3><p>好处：</p>
<ul>
<li><p>易于测试。当每个计算属性都包含一个非常简单且很少依赖的表达式时，撰写测试以确保其正确工作就会更加容易。</p>
</li>
<li><p>易于阅读。简化计算属性要求你为每一个值都起一个描述性的名称，即便它不可复用。这使得其他开发者 (以及未来的你) 更容易专注在他们关心的代码上并搞清楚发生了什么。</p>
</li>
<li><p>更好的“拥抱变化”。任何能够命名的值都可能用在视图上。举个例子，我们可能打算展示一个信息，告诉用户他们存了多少钱；也可能打算计算税费，但是可能会分开展现，而不是作为总价的一部分。</p>
</li>
</ul>
<p>小的、专注的计算属性减少了信息使用时的假设性限制，所以需求变更时也用不着那么多重构了</p>
<h3 id="attribute-值尽量都带引号"><a href="#attribute-值尽量都带引号" class="headerlink" title="attribute 值尽量都带引号"></a>attribute 值尽量都带引号</h3><p>在 HTML 中不带空格的 attribute 值是可以没有引号的，但这鼓励了大家在特征值里不写空格，导致可读性变差</p>
<h3 id="指令缩写要么都用，要么都不用"><a href="#指令缩写要么都用，要么都不用" class="headerlink" title="指令缩写要么都用，要么都不用"></a>指令缩写要么都用，要么都不用</h3><p>指令缩写 (用 <code>:</code> 表示 <code>v-bind:</code>、用 <code>@</code> 表示 <code>v-on:</code> 和用 <code>#</code> 表示 <code>v-slot:</code>) 应该要么都用要么都不用。</p>
<h2 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h2><h3 id="组件中选项的顺序"><a href="#组件中选项的顺序" class="headerlink" title="组件中选项的顺序"></a>组件中选项的顺序</h3><ul>
<li>el</li>
<li>name</li>
<li>components/directives/filters</li>
<li>mixins/extends</li>
<li>props</li>
<li>data</li>
<li>computed</li>
<li>watch</li>
<li>created之类的生命周期钩子</li>
<li>methods</li>
<li>template</li>
</ul>
<h3 id="属性顺序"><a href="#属性顺序" class="headerlink" title="属性顺序"></a>属性顺序</h3><ul>
<li>is</li>
<li>v-for</li>
<li>v-if/v-show</li>
<li>v-pre/v-once</li>
<li>id</li>
<li>ref</li>
<li>key</li>
<li>v-model</li>
<li>其他</li>
<li>v-on</li>
<li>v-html/v-text</li>
</ul>
<h3 id="组件中顶级元素的顺序保持一致"><a href="#组件中顶级元素的顺序保持一致" class="headerlink" title="组件中顶级元素的顺序保持一致"></a>组件中顶级元素的顺序保持一致</h3><p>template/script/style</p>
<h2 id="谨慎"><a href="#谨慎" class="headerlink" title="谨慎"></a>谨慎</h2><h3 id="如果一组-v-if-v-else-的元素类型相同，最好使用-key-比如两个-lt-div-gt-元素"><a href="#如果一组-v-if-v-else-的元素类型相同，最好使用-key-比如两个-lt-div-gt-元素" class="headerlink" title="如果一组 v-if + v-else 的元素类型相同，最好使用 key (比如两个 &lt;div&gt; 元素)"></a>如果一组 v-if + v-else 的元素类型相同，最好使用 key (比如两个 <code>&lt;div&gt;</code> 元素)</h3><p>默认情况下，Vue 会尽可能高效的更新 DOM。这意味着其在相同类型的元素之间切换时，会修补已存在的元素，而不是将旧的元素移除然后在同一位置添加一个新元素。如果本不相同的元素被识别为相同，则会出现意料之外的结果。</p>
<h3 id="scoped-中的避免元素选择器，而尽量用类选择器"><a href="#scoped-中的避免元素选择器，而尽量用类选择器" class="headerlink" title="scoped 中的避免元素选择器，而尽量用类选择器"></a>scoped 中的避免元素选择器，而尽量用类选择器</h3><p>在 scoped 样式中，类选择器比元素选择器更好，因为大量使用元素选择器是很慢的。</p>
<h3 id="优先通过-prop-和事件进行父子组件之间的通信，而不是-this-parent-或变更-prop"><a href="#优先通过-prop-和事件进行父子组件之间的通信，而不是-this-parent-或变更-prop" class="headerlink" title="优先通过 prop 和事件进行父子组件之间的通信，而不是 this.$parent 或变更 prop"></a>优先通过 prop 和事件进行父子组件之间的通信，而不是 this.$parent 或变更 prop</h3><p>一个理想的 Vue 应用是 prop 向下传递，事件向上传递的。遵循这一约定会让你的组件更易于理解。然而，在一些边界情况下 prop 的变更或 this.$parent 能够简化两个深度耦合的组件。</p>
<p>问题在于，这种做法在很多简单的场景下可能会更方便。但请当心，不要为了一时方便 (少写代码) 而牺牲数据流向的简洁性 (易于理解)。</p>
<h3 id="应该优先通过-Vuex-管理全局状态，而不是通过-this-root-或一个全局事件总线"><a href="#应该优先通过-Vuex-管理全局状态，而不是通过-this-root-或一个全局事件总线" class="headerlink" title="应该优先通过 Vuex 管理全局状态，而不是通过 this.$root 或一个全局事件总线"></a>应该优先通过 Vuex 管理全局状态，而不是通过 this.$root 或一个全局事件总线</h3><p>通过 this.$root 和/或全局事件总线管理状态在很多简单的情况下都是很方便的，但是并不适用于绝大多数的应用。</p>
<p>Vuex 是 Vue 的官方类 flux 实现，其提供的不仅是一个管理状态的中心区域，还是组织、追踪和调试状态变更的好工具。它很好地集成在了 Vue 生态系统之中 (包括完整的 Vue DevTools 支持)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://omizt4opc.bkt.clouddn.com/avatar.jpg"
               alt="frontzhm" />
          <p class="site-author-name" itemprop="name">frontzhm</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">230</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">39</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">54</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">frontzhm</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"frontzhm"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


  

</body>
</html>
